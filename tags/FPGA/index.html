<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Tag: FPGA - Sawen_Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Sawen_Blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Sawen_Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Sawen_Blog"><meta property="og:url" content="https://moerjie.github.io/"><meta property="og:site_name" content="Sawen_Blog"><meta property="og:locale" content="zh"><meta property="og:image" content="https://moerjie.github.io/img/og_image.png"><meta property="article:author" content="Sawen Moerjie"><meta property="article:tag" content="FPGA Verilog MATLAB Coding"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://moerjie.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://moerjie.github.io"},"headline":"Sawen_Blog","image":["https://moerjie.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Sawen Moerjie"},"publisher":{"@type":"Organization","name":"Sawen_Blog","logo":{"@type":"ImageObject","url":"https://moerjie.github.io/img/favicon.png"}},"description":""}</script><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.png" alt="Sawen_Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags/">Tags</a></li><li class="is-active"><a href="#" aria-current="page">FPGA</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-26T16:00:00.000Z" title="2025/1/27 00:00:00">2025-01-27</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-27T05:57:10.051Z" title="2025/1/27 13:57:10">2025-01-27</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">8 minutes lesen (Über 1241 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/27/ZYNQ-PS%20GPIO%E4%B8%AD%E6%96%AD%E8%BF%87%E7%A8%8B/">ZYNQ-PS GPIO中断过程</a></p><div class="content"><h1 id="中断初始化设置过程"><a href="#中断初始化设置过程" class="headerlink" title="中断初始化设置过程"></a>中断初始化设置过程</h1><ol>
<li>查找中断控制器配置信息并初始化中断控制器驱动（XScuGic_LookupConfig、XScuGic_CfgInitialize）</li>
<li>设置中断类型（XScuGic_SetPriorityTriggerType）</li>
<li>为中断设置中断处理函数（XScuGic_Connect）</li>
<li>使能中断 (XScuGic_Enable)</li>
<li>设置并使能中断异常（Xil_ExceptionInit、Xil_ExceptionRegisterHandler、Xil_ExceptionEnable）</li>
<li>打开 GPIO 中断（XGpioPs_IntrEnablePin）<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501271314763.png" alt="intrrupt.drawio.png|430"></li>
</ol>
<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><p>该代码包含部分 AXI GPIO 初始化的代码，其余都为 PS 端 GPIO 的初始化和中断初始化配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2002 - 2021 Xilinx, Inc.  All rights reserved.</span></span><br><span class="line"><span class="comment"> * SPDX-License-Identifier: MIT</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @file xgpio_example.c</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This file contains a design example using the AXI GPIO driver (XGpio) and</span></span><br><span class="line"><span class="comment"> * hardware device.  It only uses channel 1 of a GPIO device and assumes that</span></span><br><span class="line"><span class="comment"> * the bit 0 of the GPIO is connected to the LED on the HW board.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;pre&gt;</span></span><br><span class="line"><span class="comment"> * MODIFICATION HISTORY:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Ver   Who  Date     Changes</span></span><br><span class="line"><span class="comment"> * ----- ---- -------- -----------------------------------------------</span></span><br><span class="line"><span class="comment"> * 1.00a rmm  03/13/02 First release</span></span><br><span class="line"><span class="comment"> * 1.00a rpm  08/04/03 Removed second example and invalid macro calls</span></span><br><span class="line"><span class="comment"> * 2.00a jhl  12/15/03 Added support for dual channels</span></span><br><span class="line"><span class="comment"> * 2.00a sv   04/20/05 Minor changes to comply to Doxygen and coding guidelines</span></span><br><span class="line"><span class="comment"> * 3.00a ktn  11/20/09 Minor changes as per coding guidelines.</span></span><br><span class="line"><span class="comment"> * 4.1   lks  11/18/15 Updated to use canonical xparameters and</span></span><br><span class="line"><span class="comment"> *		      clean up of the comments and code for CR 900381</span></span><br><span class="line"><span class="comment"> * 4.3   sk   09/29/16 Modified the example to make it work when LED_bits are</span></span><br><span class="line"><span class="comment"> *                     configured as an output. CR# 958644</span></span><br><span class="line"><span class="comment"> *       ms   01/23/17 Added xil_printf statement in main function to</span></span><br><span class="line"><span class="comment"> *                     ensure that "Successfully ran" and "Failed" strings</span></span><br><span class="line"><span class="comment"> *                     are available in all examples. This is a fix for</span></span><br><span class="line"><span class="comment"> *                     CR-965028.</span></span><br><span class="line"><span class="comment"> * 4.5  sne   06/12/19 Fixed IAR compiler warning.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************** Include Files *********************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xparameters.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xgpio.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xil_printf.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"sleep.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xscugic.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xil_exception.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;xgpiops.h&gt;</span></span></span><br><span class="line"><span class="comment">/************************** Constant Definitions *****************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODE_SINGLE_TONE 0x00</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODE_PRINTER 0x01</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The following constants map to the XPAR parameters created in the</span></span><br><span class="line"><span class="comment"> * xparameters.h file. They are defined here such that a user can easily</span></span><br><span class="line"><span class="comment"> * change all the needed parameters in one place.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//PS端GPIO器件ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_EXAMPLE_DEVICE_ID XPAR_GPIO_0_DEVICE_ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The following constant is used to wait after an LED is turned on to make</span></span><br><span class="line"><span class="comment"> * sure that it is visible to the human eye.  This constant might need to be</span></span><br><span class="line"><span class="comment"> * tuned for faster or slower processor speeds.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LED_DELAY 10000000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The following constant is used to determine which channel of the GPIO is</span></span><br><span class="line"><span class="comment"> * used for the LED if there are 2 channels supported.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MODE_CHANGE_CHANNEL 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*GPIO define	*/</span></span><br><span class="line"><span class="comment">//PS端GPIO器件ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIO_ID XPAR_PS7_GPIO_0_DEVICE_ID</span></span><br><span class="line"><span class="comment">//通用中断控制器ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC_DEVICE_ID XPAR_SCUGIC_SINGLE_DEVICE_ID</span></span><br><span class="line"><span class="comment">//PS端GPIO中断ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KEY_INTR_ID XPAR_XGPIOPS_0_INTR</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_KEY_MIO 50 <span class="comment">//key连接到MIO50</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_LED_MIO_1 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PS_LED_MIO_2 13</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_INPUT 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GPIO_OUTPUT 0</span></span><br><span class="line"><span class="comment">/**************************** Type Definitions *******************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************** Macros (Inline Functions) Definitions *********************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">XGpio</span> <span class="title">XGpio</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/************************** Function Prototypes ******************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">IntrInitFunction</span><span class="params">(XScuGic *InstancePtr, u16 DeviceId, XGpioPs *GpioInstancePtr)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">GpioHandler</span><span class="params">(<span class="type">void</span> *CallBackRef)</span>;</span><br><span class="line"><span class="comment">/************************** Variable Definitions *****************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * The following are declared globally so they are zeroed and so they are</span></span><br><span class="line"><span class="comment"> * easily accessible from a debugger</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">XGpio Gpio; <span class="comment">/* PL端AXI GPIO外设驱动实例 */</span></span><br><span class="line"></span><br><span class="line">XGpioPs GpioPs; <span class="comment">/* PS端GPIO外设驱动实例 */</span></span><br><span class="line"></span><br><span class="line">XScuGic INTCInst; <span class="comment">/* 通用中断控制器驱动实例 */</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> key_flag; <span class="comment">// ps key 0 flag</span></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The purpose of this function is to illustrate how to use the GPIO</span></span><br><span class="line"><span class="comment"> * driver to turn on and off an LED.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return	XST_FAILURE to indicate that the GPIO Initialization had</span></span><br><span class="line"><span class="comment"> *		failed.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		This function will not return if the test is running.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	XGpioPs_Config *GpioConfig;	<span class="comment">/*PS端GPIO配置信息*/</span></span><br><span class="line">	<span class="type">int</span> Status;</span><br><span class="line">	<span class="type">int</span> mode_flag = <span class="number">0</span>;</span><br><span class="line">	key_flag = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* Initialize the GPIOps driver*/</span></span><br><span class="line">	<span class="comment">/*根据器件ID查找配置信息*/</span></span><br><span class="line">	GpioConfig = XGpioPs_LookupConfig(MIO_ID);</span><br><span class="line">	<span class="comment">/*初始化GPIO Driver*/</span></span><br><span class="line">	Status = XGpioPs_CfgInitialize(&amp;GpioPs, GpioConfig, GpioConfig-&gt;BaseAddr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"GpioPs Initialization Failed\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"GpioPs Initialization Success\r\n"</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">/* Initialize the GPIO driver */</span></span><br><span class="line">	<span class="comment">/*初始化PL端AXI GPIO驱动*/</span></span><br><span class="line">	Status = XGpio_Initialize(&amp;Gpio, GPIO_EXAMPLE_DEVICE_ID);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Gpio Initialization Failed\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Gpio Initialization Success\r\n"</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*GPIO_PS Intr init*/</span></span><br><span class="line">	<span class="comment">/*设置KEY连接的MIO引脚的方向为输入*/</span></span><br><span class="line">	XGpioPs_SetDirectionPin(&amp;GpioPs, PS_KEY_MIO, GPIO_INPUT);</span><br><span class="line">	<span class="comment">/*使能按键中断*/</span></span><br><span class="line">	XGpioPs_SetIntrTypePin(&amp;GpioPs, PS_KEY_MIO, XGPIOPS_IRQ_TYPE_EDGE_RISING);</span><br><span class="line">	XGpioPs_IntrEnablePin(&amp;GpioPs, PS_KEY_MIO);</span><br><span class="line">	Status = IntrInitFunction(&amp;INTCInst, MIO_ID, &amp;GpioPs);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"IntrInitFunction Failed\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"IntrInitFunction Success\r\n"</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set the direction for GPIO OUT */</span></span><br><span class="line">	XGpio_SetDataDirection(&amp;Gpio, MODE_CHANGE_CHANNEL, GPIO_OUTPUT);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*Set the direction for PS GPIO 1 for output &amp; 0 for input*/</span></span><br><span class="line">	XGpioPs_SetDirectionPin(&amp;GpioPs, PS_LED_MIO_1, <span class="number">1</span>);</span><br><span class="line">	XGpioPs_SetDirectionPin(&amp;GpioPs, PS_LED_MIO_2, <span class="number">1</span>);</span><br><span class="line">	XGpioPs_SetOutputEnablePin(&amp;GpioPs, PS_LED_MIO_1, <span class="number">1</span>);</span><br><span class="line">	XGpioPs_SetOutputEnablePin(&amp;GpioPs, PS_LED_MIO_2, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">/* Loop forever blinking the LED */</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">if</span> (key_flag)</span><br><span class="line">		{</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (mode_flag == <span class="number">0</span>)</span><br><span class="line">			{</span><br><span class="line">				XGpio_DiscreteWrite(&amp;Gpio, MODE_CHANGE_CHANNEL, MODE_SINGLE_TONE);</span><br><span class="line">				xil_printf(<span class="string">"MODE_SINGLE_TONE, mode flag:%d\r\n"</span>, mode_flag);</span><br><span class="line">				XGpioPs_WritePin(&amp;GpioPs, PS_LED_MIO_1, <span class="number">0</span>); <span class="comment">// LED1 ON</span></span><br><span class="line">				XGpioPs_WritePin(&amp;GpioPs, PS_LED_MIO_2, <span class="number">1</span>); <span class="comment">// LED2 OFF</span></span><br><span class="line">				mode_flag++;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (mode_flag == <span class="number">1</span>)</span><br><span class="line">			{</span><br><span class="line">				XGpio_DiscreteWrite(&amp;Gpio, MODE_CHANGE_CHANNEL, MODE_PRINTER);</span><br><span class="line">				xil_printf(<span class="string">"Painter, mode flag:%d\r\n"</span>, mode_flag);</span><br><span class="line">				XGpioPs_WritePin(&amp;GpioPs, PS_LED_MIO_1, <span class="number">1</span>); <span class="comment">// LED1 OFF</span></span><br><span class="line">				XGpioPs_WritePin(&amp;GpioPs, PS_LED_MIO_2, <span class="number">0</span>); <span class="comment">// LED2 ON</span></span><br><span class="line">				mode_flag = <span class="number">0</span>;</span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">			key_flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">IntrInitFunction</span><span class="params">(XScuGic *InstancePtr, u16 DeviceId, XGpioPs *GpioInstancePtr)</span></span><br><span class="line">{</span><br><span class="line">	XScuGic_Config *IntcConfig; <span class="comment">/*中断控制器配置信息*/</span></span><br><span class="line">	<span class="type">int</span> Status;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Initialize the interrupt controller driver so that it is ready to</span></span><br><span class="line"><span class="comment">	 * use.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">/*查找中断控制器配置信息并初始化中断控制器驱动*/</span></span><br><span class="line">	IntcConfig = XScuGic_LookupConfig(INTC_DEVICE_ID);</span><br><span class="line"></span><br><span class="line">	Status = XScuGic_CfgInitialize(InstancePtr, IntcConfig, IntcConfig-&gt;CpuBaseAddress);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * set priority and trigger type</span></span><br><span class="line"><span class="comment">	 * 设置中断类型为上升沿中断</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	XScuGic_SetPriorityTriggerType(InstancePtr, KEY_INTR_ID,</span><br><span class="line">								   <span class="number">0xA0</span>, <span class="number">0x3</span>);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Connect the device driver handler that will be called when an</span></span><br><span class="line"><span class="comment">	 * interrupt for the device occurs, the handler defined above performs</span></span><br><span class="line"><span class="comment">	 * the specific interrupt processing for the device.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">/*为中断设置中断处理函数*/</span></span><br><span class="line">	Status = XScuGic_Connect(InstancePtr, KEY_INTR_ID,</span><br><span class="line">							 (Xil_ExceptionHandler)GpioHandler,</span><br><span class="line">							 (<span class="type">void</span> *)GpioInstancePtr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Enable the interrupt for the device.</span></span><br><span class="line"><span class="comment">	 * 使能来自GPIO的中断</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	XScuGic_Enable(InstancePtr, KEY_INTR_ID);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*设置并使能中断异常*/</span></span><br><span class="line">	Xil_ExceptionInit();</span><br><span class="line"></span><br><span class="line">	Xil_ExceptionRegisterHandler(XIL_EXCEPTION_ID_INT,</span><br><span class="line">								 (Xil_ExceptionHandler)XScuGic_InterruptHandler,</span><br><span class="line">								 InstancePtr);</span><br><span class="line">	Xil_ExceptionEnable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> XST_SUCCESS;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">GpioHandler</span><span class="params">(<span class="type">void</span> *CallBackRef)</span></span><br><span class="line">{</span><br><span class="line">	XGpioPs *GpioInstancePtr = (XGpioPs *)CallBackRef;</span><br><span class="line">	<span class="type">int</span> intr_val;</span><br><span class="line"></span><br><span class="line">	intr_val = XGpioPs_IntrGetStatusPin(GpioInstancePtr, PS_KEY_MIO);</span><br><span class="line">	<span class="comment">/* Clear the interrupt */</span></span><br><span class="line">	XGpioPs_IntrClearPin(GpioInstancePtr, PS_KEY_MIO);</span><br><span class="line">	<span class="keyword">if</span> (intr_val)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Button Pressed\r\n"</span>);</span><br><span class="line">		key_flag = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-24T16:00:00.000Z" title="2025/1/25 00:00:00">2025-01-25</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-26T12:01:33.458Z" title="2025/1/26 20:01:33">2025-01-26</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">23 minutes lesen (Über 3420 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/25/ZYNQ-AXI%20DMA+AXI-S%20FIFO%E5%9B%9E%E7%8E%AF%E5%AD%A6%E4%B9%A0/">AXI DMA+AXI-S FIFO回环学习</a></p><div class="content"><h1 id="DMA-简介"><a href="#DMA-简介" class="headerlink" title="DMA 简介"></a>DMA 简介</h1><p>DMA 是现代计算机的特色之一，是硬件实现存储器与存储器、存储器与 I/O 设备之间直接进行高速数据传输的内存技术，它允许不同速率的设备进行沟通，而不需要依靠 CPU 的中断负载。<br>如果不使用 DMA，那么 CPU 需要从数据源把每一个片段的数据复制到寄存器中，这个过程会一直占用 CPU 的资源。当使用 DMA 时，CPU 向 DMA 发送一个存储传输请求，当 DMA 控制器收到请求时就会将数据从源地址搬运到目的地址，搬运过程中不消化 CPU 的资源，当传输完成后 DMA 控制器以中断的方式通知 CPU。<br>为了发起传输事务，DMA 控制器必须有：</p>
<ol>
<li>源地址</li>
<li>目的地址</li>
<li>传输长度<br>DMA 存储传输的过程如下： </li>
<li>处理器向 DMA 控制器发送一条 DMA 命令</li>
<li>DMA 控制器把数据从外设传输到存储器或从存储器搬运到存储器，而让 CPU 腾出手来做其它操作</li>
<li>数据传输完成后，DMA 控制器向 CPU 发出一个中断，来通知处理器 DMA 传输完成</li>
</ol>
<p>ZYNQ 提供两种 DMA，一种是集成在 PS 中的硬核 DMA，一种是 PL 中的软核 AXI DMA IP。<br>各种接口方式的比较如下：<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501251640116.png" alt="|500"><br>PL 的 DMA 和 AXI_HP 接口的传输适用于大量数据的高性能传输，带宽高，传输方式的拓扑图如下：<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501251637054.png" alt="|500"></p>
<h2 id="AXI-DMA-IP"><a href="#AXI-DMA-IP" class="headerlink" title="AXI DMA IP"></a>AXI DMA IP</h2><p>AXI Direct Memory Access（AXI DMA）IP 核在 AXI 4 内存映射和 AXI 4-Stream IP 接口之间提供高带宽直接储存访问。</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501251031208.png" alt="|500"><br>AXI DMA 用到了三种总线。AXI 4-Lite 用于对寄存器进行配置，AXI 4 Memory Map 总线用于读写 DDR 中的数据，AXI 4 Stream 总线用于 AXI DMA 对外设数据的读写，其中 AXI 4 Stream Master（MM 2 S，Memory Map to Stream）接口用于向 PL写入数据，AXI 4-Stream Slave (S 2 MM，Stream to Memory Map) 接口用于从 PL读取数据。<br>AXI DMA 提供 3 种模式，分别是 Direct Register 模式、Scatter/Gather 模式和 Cyclic DMA（循环 DMA）模式，常用的是 Direct Register 模式。<br>Direct Register DMA 模式即 Simple DMA 模式。Direct Register 模式提供了一种配置，用于在 MM 2 S 和 S 2 MM 通道上执行简单的 DMA 传输。Simple DMA（简单 DMA）允许应用程序在 DMA 和 Device 之间定义单个事务。它有两个通道：一个从 DMA 到 Device，另一个从 Device 到 DMA。这里有个地方需要大家注意下，在编写 Simple DMA（简单 DMA）代码时必须设置缓冲区地址和长度字段以启动相应通道中的传输。（其中 PL 对应 Device）</p>
<h3 id="Vivado-中的-IP-配置"><a href="#Vivado-中的-IP-配置" class="headerlink" title="Vivado 中的 IP 配置"></a>Vivado 中的 IP 配置</h3><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501252113134.png"></p>
<p><strong>Enable Scatter Gather Engine</strong><br>选中此选项可启用 Scatter Gather 模式操作，并在 AXI DMA 中包含 Scatter Gather Engine。取消选中此选项可启用 Direct Register 模式操作，但不包括 AXI DMA 中的 Scatter Gather Engine。禁用 Scatter Gather Engine 会使 Scatter/Gather Engine 的所有输出端口都绑定为零，并且所有输入端口都将保持打开状态。此处我们取消勾选 Enable Scatter Gather Engine<br><strong>Enable Micro DMA</strong><br>使能后会生成高度优化的 DMA，资源消耗较少，用于极少量数据的传输<br><strong>Width of Buffer Length Register</strong><br>该选项配置了 AXI DMA 单次最大能搬运多少个字节，字节数 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.267ex" height="2.117ex" role="img" focusable="false" viewBox="0 -853.7 3654 935.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(1055.8,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mi" transform="translate(1048,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1393,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(1913,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2274,0)"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g></g></g></g></g></svg></mjx-container><br><strong>Address Width (32 - 64)</strong><br>指定地址空间的宽度，可以是 32 到 64 之间的任意值<br><strong>Enable Read Channel</strong><br>开启 AXI DMA 的读通道 MM 2 S，相关配置如下：</p>
<ul>
<li>Number of Channels：指定通道数。保持默认值 1</li>
<li>Memory Map Data Width：AXI MM 2 S 存储映射读取数据总线的数据位宽。有效值为 32、64、128、256、512 和 1024。此处保持默认值 32</li>
<li>Stream Data Width：AXI MM 2 S AXI 4-Stream 数据总线的数据位宽。该值必须小于或等于 Memory Map Data Width。有效值为 8、16、32、64、128、512 和 1024。此处保持默认值 32</li>
<li>Max Burst Size：突发分区粒度设置。此设置指定 MM 2 S 的 AXI 4-Memory Map 侧的突发周期的最大值。有效值为 2、4、8、16、32、64、128 和 256</li>
<li>Allow Unaligned Transfers：启用或禁用 MM 2 S 数据重新排列引擎（Data Realignment Engine，DRE）。选中时，DRE 被使能并允许在 MM 2 S 存储映射数据路径上数据重新对齐到 8 位的字节水平。对于 MM 2 S通道，则从内存中读取数据。如果 DRE 被使能，则数据读取可以从任何缓冲区地址字节偏移开始，并且读取数据被对齐，使得第一个字节读取是 AXI 4-Stream 上的第一个有效字节输出<br><strong>Enable Write Channel</strong><br>开启 AXI DMA 的写通道 S 2 MM，相关配置同上</li>
</ul>
<h1 id="Vitis-工程解析"><a href="#Vitis-工程解析" class="headerlink" title="Vitis 工程解析"></a>Vitis 工程解析</h1><h2 id="头文件引用和宏定义"><a href="#头文件引用和宏定义" class="headerlink" title="头文件引用和宏定义"></a>头文件引用和宏定义</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************** Include Files *********************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xaxidma.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xparameters.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xil_exception.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xdebug.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xil_util.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_UARTNS550_0_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xuartns550_l.h"</span> <span class="comment">/* to use uartns550 */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xintc.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"xscugic.h"</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/************************** Constant Definitions *****************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Device hardware build related constants.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DMA_DEV_ID XPAR_AXIDMA_0_DEVICE_ID</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_AXI_7SDDR_0_S_AXI_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DDR_BASE_ADDR XPAR_AXI_7SDDR_0_S_AXI_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(XPAR_MIG7SERIES_0_BASEADDR)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DDR_BASE_ADDR XPAR_MIG7SERIES_0_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(XPAR_MIG_0_C0_DDR4_MEMORY_MAP_BASEADDR)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DDR_BASE_ADDR XPAR_MIG_0_C0_DDR4_MEMORY_MAP_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(XPAR_PSU_DDR_0_S_AXI_BASEADDR)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DDR_BASE_ADDR XPAR_PSU_DDR_0_S_AXI_BASEADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DDR_BASE_ADDR XPAR_PS7_DDR_0_S_AXI_BASEADDR <span class="comment">// 0x00100000</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DDR_BASE_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">warning</span> CHECK FOR THE VALID DDR ADDRESS IN XPARAMETERS.H, \</span></span><br><span class="line"><span class="meta">		DEFAULT SET TO 0x01000000</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEM_BASE_ADDR 0x01000000</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MEM_BASE_ADDR (DDR_BASE_ADDR + 0x01000000) <span class="comment">// 0x01100000</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RX_INTR_ID XPAR_INTC_0_AXIDMA_0_S2MM_INTROUT_VEC_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TX_INTR_ID XPAR_INTC_0_AXIDMA_0_MM2S_INTROUT_VEC_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RX_INTR_ID XPAR_FABRIC_AXIDMA_0_S2MM_INTROUT_VEC_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TX_INTR_ID XPAR_FABRIC_AXIDMA_0_MM2S_INTROUT_VEC_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TX_BUFFER_BASE (MEM_BASE_ADDR + 0x00100000) <span class="comment">// 0x01200000</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RX_BUFFER_BASE (MEM_BASE_ADDR + 0x00300000) <span class="comment">// 0x01400000</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RX_BUFFER_HIGH (MEM_BASE_ADDR + 0x004FFFFF) <span class="comment">// 0x015FFFFF</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC_DEVICE_ID XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC_DEVICE_ID XPAR_SCUGIC_SINGLE_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC XIntc</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC_HANDLER XIntc_InterruptHandler</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC XScuGic</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INTC_HANDLER XScuGic_InterruptHandler</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Timeout loop counter for reset</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RESET_TIMEOUT_COUNTER 10000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TEST_START_VALUE 0x1</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Buffer and Buffer Descriptor related constant definition</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_PKT_LEN 0x200</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUMBER_OF_TRANSFERS 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> POLL_TIMEOUT_COUNTER 1000000U</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NUMBER_OF_EVENTS 1</span></span><br></pre></td></tr></table></figure>
<p><code>#define DDR_BASE_ADDR XPAR_AXI_7SDDR_0_S_AXI_BASEADDR</code> 重新定义了 DDR 3 的基址.。数据读写的基址为 <code>#define MEM_BASE_ADDR (DDR_BASE_ADDR + 0x01000000) // 0x01100000</code> AXI DMA 读取数据的起始地址为 <code>#define TX_BUFFER_BASE (MEM_BASE_ADDR + 0x00100000) // 0x01200000</code>，写入地址为 <code>0x01400000</code></p>
<h2 id="定义函数和声明相关的-instance-和-flag-变量"><a href="#定义函数和声明相关的-instance-和-flag-变量" class="headerlink" title="定义函数和声明相关的 instance 和 flag 变量"></a>定义函数和声明相关的 instance 和 flag 变量</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************** Type Definitions *******************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************** Macros (Inline Functions) Definitions *********************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/************************** Function Prototypes ******************************/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DEBUG</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">xil_printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_UARTNS550_0_BASEADDR</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">Uart550_Setup</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">CheckData</span><span class="params">(<span class="type">int</span> Length, u8 StartValue)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">TxIntrHandler</span><span class="params">(<span class="type">void</span> *Callback)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">RxIntrHandler</span><span class="params">(<span class="type">void</span> *Callback)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">SetupIntrSystem</span><span class="params">(INTC *IntcInstancePtr,</span></span><br><span class="line"><span class="params">						   XAxiDma *AxiDmaPtr, u16 TxIntrId, u16 RxIntrId)</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">DisableIntrSystem</span><span class="params">(INTC *IntcInstancePtr,</span></span><br><span class="line"><span class="params">							  u16 TxIntrId, u16 RxIntrId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************** Variable Definitions *****************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Device instance definitions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> XAxiDma AxiDma; <span class="comment">/* Instance of the XAxiDma */</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> INTC Intc; <span class="comment">/* Instance of the Interrupt Controller */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Flags interrupt handlers use to notify the application context the events.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">volatile</span> u32 TxDone;</span><br><span class="line"><span class="keyword">volatile</span> u32 RxDone;</span><br><span class="line"><span class="keyword">volatile</span> u32 Error;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Main-函数"><a href="#Main-函数" class="headerlink" title="Main 函数"></a>Main 函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Main function</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function is the main entry of the interrupt test. It does the following:</span></span><br><span class="line"><span class="comment"> *	Set up the output terminal if UART16550 is in the hardware build</span></span><br><span class="line"><span class="comment"> *	Initialize the DMA engine</span></span><br><span class="line"><span class="comment"> *	Set up Tx and Rx channels</span></span><br><span class="line"><span class="comment"> *	Set up the interrupt system for the Tx and Rx interrupts</span></span><br><span class="line"><span class="comment"> *	Submit a transfer</span></span><br><span class="line"><span class="comment"> *	Wait for the transfer to finish</span></span><br><span class="line"><span class="comment"> *	Check transfer status</span></span><br><span class="line"><span class="comment"> *	Disable Tx and Rx interrupts</span></span><br><span class="line"><span class="comment"> *	Print test status and exit</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	None</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> *		- XST_SUCCESS if example finishes successfully</span></span><br><span class="line"><span class="comment"> *		- XST_FAILURE if example fails.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">int</span> Status;</span><br><span class="line">	XAxiDma_Config *Config;</span><br><span class="line">	<span class="type">int</span> Tries = NUMBER_OF_TRANSFERS;</span><br><span class="line">	<span class="type">int</span> Index;</span><br><span class="line">	u8 *TxBufferPtr;</span><br><span class="line">	u8 *RxBufferPtr;</span><br><span class="line">	u8 Value;</span><br><span class="line"></span><br><span class="line">	TxBufferPtr = (u8 *)TX_BUFFER_BASE;</span><br><span class="line">	RxBufferPtr = (u8 *)RX_BUFFER_BASE;</span><br><span class="line">	<span class="comment">/* Initial setup for Uart16550 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_UARTNS550_0_BASEADDR</span></span><br><span class="line"></span><br><span class="line">	Uart550_Setup();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	xil_printf(<span class="string">"\r\n--- Entering main() --- \r\n"</span>);</span><br><span class="line"></span><br><span class="line">	Config = XAxiDma_LookupConfig(DMA_DEV_ID);</span><br><span class="line">	<span class="keyword">if</span> (!Config)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"No config found for %d\r\n"</span>, DMA_DEV_ID);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Config found for %d\r\n"</span>, DMA_DEV_ID);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize DMA engine */</span></span><br><span class="line">	Status = XAxiDma_CfgInitialize(&amp;AxiDma, Config);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Initialization failed %d\r\n"</span>, Status);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"DMA Initialization success %d\r\n"</span>, Status);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (XAxiDma_HasSg(&amp;AxiDma))</span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Device configured as SG mode \r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	{</span><br><span class="line">		xil_printf(<span class="string">"Device configured as simple mode \r\n"</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Set up Interrupt system  */</span></span><br><span class="line">	Status = SetupIntrSystem(&amp;Intc, &amp;AxiDma, TX_INTR_ID, RX_INTR_ID);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		xil_printf(<span class="string">"Failed intr setup\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Disable all interrupts before setup */</span></span><br><span class="line"></span><br><span class="line">	XAxiDma_IntrDisable(&amp;AxiDma, XAXIDMA_IRQ_ALL_MASK,</span><br><span class="line">						XAXIDMA_DMA_TO_DEVICE);</span><br><span class="line"></span><br><span class="line">	XAxiDma_IntrDisable(&amp;AxiDma, XAXIDMA_IRQ_ALL_MASK,</span><br><span class="line">						XAXIDMA_DEVICE_TO_DMA);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Enable all interrupts */</span></span><br><span class="line">	XAxiDma_IntrEnable(&amp;AxiDma, XAXIDMA_IRQ_ALL_MASK,</span><br><span class="line">					   XAXIDMA_DMA_TO_DEVICE);</span><br><span class="line"></span><br><span class="line">	XAxiDma_IntrEnable(&amp;AxiDma, XAXIDMA_IRQ_ALL_MASK,</span><br><span class="line">					   XAXIDMA_DEVICE_TO_DMA);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize flags before start transfer test  */</span></span><br><span class="line">	TxDone = <span class="number">0</span>;</span><br><span class="line">	RxDone = <span class="number">0</span>;</span><br><span class="line">	Error = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	Value = TEST_START_VALUE;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Index = <span class="number">0</span>; Index &lt; MAX_PKT_LEN; Index++)</span><br><span class="line">	{</span><br><span class="line">		TxBufferPtr[Index] = Value;</span><br><span class="line"></span><br><span class="line">		Value = (Value + <span class="number">1</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Flush the buffers before the DMA transfer, in case the Data Cache</span></span><br><span class="line"><span class="comment">	 * is enabled</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Xil_DCacheFlushRange((UINTPTR)TxBufferPtr, MAX_PKT_LEN);</span><br><span class="line">	Xil_DCacheFlushRange((UINTPTR)RxBufferPtr, MAX_PKT_LEN);</span><br><span class="line">	<span class="comment">/* Send a packet */</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; Tries; i++)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		Status = XAxiDma_SimpleTransfer(&amp;AxiDma, (UINTPTR)RxBufferPtr,</span><br><span class="line">										MAX_PKT_LEN, XAXIDMA_DEVICE_TO_DMA);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		Status = XAxiDma_SimpleTransfer(&amp;AxiDma, (UINTPTR)TxBufferPtr,</span><br><span class="line">										MAX_PKT_LEN, XAXIDMA_DMA_TO_DEVICE);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		Status = Xil_WaitForEventSet(POLL_TIMEOUT_COUNTER, NUMBER_OF_EVENTS, &amp;Error);</span><br><span class="line">		<span class="keyword">if</span> (Status == XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			<span class="keyword">if</span> (!TxDone)</span><br><span class="line">			{</span><br><span class="line">				xil_printf(<span class="string">"Transmit error %d\r\n"</span>, Status);</span><br><span class="line">				<span class="keyword">goto</span> Done;</span><br><span class="line">			}</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (Status == XST_SUCCESS &amp;&amp; !RxDone)</span><br><span class="line">			{</span><br><span class="line">				xil_printf(<span class="string">"Receive error %d\r\n"</span>, Status);</span><br><span class="line">				<span class="keyword">goto</span> Done;</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Wait for TX done or timeout</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		Status = Xil_WaitForEventSet(POLL_TIMEOUT_COUNTER, NUMBER_OF_EVENTS, &amp;TxDone);</span><br><span class="line">		<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			xil_printf(<span class="string">"Transmit failed %d\r\n"</span>, Status);</span><br><span class="line">			<span class="keyword">goto</span> Done;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Wait for RX done or timeout</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		Status = Xil_WaitForEventSet(POLL_TIMEOUT_COUNTER, NUMBER_OF_EVENTS, &amp;RxDone);</span><br><span class="line">		<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			xil_printf(<span class="string">"Receive failed %d\r\n"</span>, Status);</span><br><span class="line">			<span class="keyword">goto</span> Done;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Test finished, check data</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		Status = CheckData(MAX_PKT_LEN, <span class="number">0x1</span>);</span><br><span class="line">		<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">		{</span><br><span class="line">			xil_printf(<span class="string">"Data check failed\r\n"</span>);</span><br><span class="line">			<span class="keyword">goto</span> Done;</span><br><span class="line">		}</span><br><span class="line">		xil_printf(<span class="string">"Transfer %d done\r\n"</span>, i + <span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	xil_printf(<span class="string">"Successfully ran AXI DMA interrupt Example\r\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Disable TX and RX Ring interrupts and return success */</span></span><br><span class="line"></span><br><span class="line">	DisableIntrSystem(&amp;Intc, TX_INTR_ID, RX_INTR_ID);</span><br><span class="line"></span><br><span class="line">Done:</span><br><span class="line">	xil_printf(<span class="string">"--- Exiting main() --- \r\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> XST_SUCCESS;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>Tries</code> 为测试回环的次数</p>
<h2 id="函数的实现"><a href="#函数的实现" class="headerlink" title="函数的实现"></a>函数的实现</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br></pre></td><td class="code"><pre><span class="line">*****************************************************************************/</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function checks data buffer after the DMA transfer is finished.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * We use the static tx/rx buffers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	Length is the length to check</span></span><br><span class="line"><span class="comment"> * @param	StartValue is the starting value of the first byte</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> *		- XST_SUCCESS if validation is successful</span></span><br><span class="line"><span class="comment"> *		- XST_FAILURE if validation is failure.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">CheckData</span><span class="params">(<span class="type">int</span> Length, u8 StartValue)</span></span><br><span class="line">{</span><br><span class="line">	u8 *RxPacket;</span><br><span class="line">	<span class="type">int</span> Index = <span class="number">0</span>;</span><br><span class="line">	u8 Value;</span><br><span class="line"></span><br><span class="line">	RxPacket = (u8 *)RX_BUFFER_BASE;</span><br><span class="line">	Value = StartValue;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Invalidate the DestBuffer before receiving the data, in case the</span></span><br><span class="line"><span class="comment">	 * Data Cache is enabled</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Xil_DCacheInvalidateRange((UINTPTR)RxPacket, Length);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (Index = <span class="number">0</span>; Index &lt; Length; Index++)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">if</span> (RxPacket[Index] != Value)</span><br><span class="line">		{</span><br><span class="line">			xil_printf(<span class="string">"Data error %d: %x/%x\r\n"</span>,</span><br><span class="line">					   Index, RxPacket[Index], Value);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">		}</span><br><span class="line">		Value = (Value + <span class="number">1</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> XST_SUCCESS;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the DMA TX Interrupt handler function.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It gets the interrupt status from the hardware, acknowledges it, and if any</span></span><br><span class="line"><span class="comment"> * error happens, it resets the hardware. Otherwise, if a completion interrupt</span></span><br><span class="line"><span class="comment"> * is present, then sets the TxDone.flag</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	Callback is a pointer to TX channel of the DMA engine.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return	None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">TxIntrHandler</span><span class="params">(<span class="type">void</span> *Callback)</span></span><br><span class="line">{</span><br><span class="line"></span><br><span class="line">	u32 IrqStatus;</span><br><span class="line">	<span class="type">int</span> TimeOut;</span><br><span class="line">	XAxiDma *AxiDmaInst = (XAxiDma *)Callback;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Read pending interrupts */</span></span><br><span class="line">	IrqStatus = XAxiDma_IntrGetIrq(AxiDmaInst, XAXIDMA_DMA_TO_DEVICE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Acknowledge pending interrupts */</span></span><br><span class="line"></span><br><span class="line">	XAxiDma_IntrAckIrq(AxiDmaInst, IrqStatus, XAXIDMA_DMA_TO_DEVICE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If no interrupt is asserted, we do not do anything</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!(IrqStatus &amp; XAXIDMA_IRQ_ALL_MASK))</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If error interrupt is asserted, raise error flag, reset the</span></span><br><span class="line"><span class="comment">	 * hardware to recover from the error, and return with no further</span></span><br><span class="line"><span class="comment">	 * processing.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((IrqStatus &amp; XAXIDMA_IRQ_ERROR_MASK))</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		Error = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * Reset should never fail for transmit channel</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		XAxiDma_Reset(AxiDmaInst);</span><br><span class="line"></span><br><span class="line">		TimeOut = RESET_TIMEOUT_COUNTER;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (TimeOut)</span><br><span class="line">		{</span><br><span class="line">			<span class="keyword">if</span> (XAxiDma_ResetIsDone(AxiDmaInst))</span><br><span class="line">			{</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">			TimeOut -= <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If Completion interrupt is asserted, then set the TxDone flag</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((IrqStatus &amp; XAXIDMA_IRQ_IOC_MASK))</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		TxDone = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This is the DMA RX interrupt handler function</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * It gets the interrupt status from the hardware, acknowledges it, and if any</span></span><br><span class="line"><span class="comment"> * error happens, it resets the hardware. Otherwise, if a completion interrupt</span></span><br><span class="line"><span class="comment"> * is present, then it sets the RxDone flag.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	Callback is a pointer to RX channel of the DMA engine.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return	None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">RxIntrHandler</span><span class="params">(<span class="type">void</span> *Callback)</span></span><br><span class="line">{</span><br><span class="line">	u32 IrqStatus;</span><br><span class="line">	<span class="type">int</span> TimeOut;</span><br><span class="line">	XAxiDma *AxiDmaInst = (XAxiDma *)Callback;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Read pending interrupts */</span></span><br><span class="line">	IrqStatus = XAxiDma_IntrGetIrq(AxiDmaInst, XAXIDMA_DEVICE_TO_DMA);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Acknowledge pending interrupts */</span></span><br><span class="line">	XAxiDma_IntrAckIrq(AxiDmaInst, IrqStatus, XAXIDMA_DEVICE_TO_DMA);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If no interrupt is asserted, we do not do anything</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> (!(IrqStatus &amp; XAXIDMA_IRQ_ALL_MASK))</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If error interrupt is asserted, raise error flag, reset the</span></span><br><span class="line"><span class="comment">	 * hardware to recover from the error, and return with no further</span></span><br><span class="line"><span class="comment">	 * processing.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((IrqStatus &amp; XAXIDMA_IRQ_ERROR_MASK))</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		Error = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* Reset could fail and hang</span></span><br><span class="line"><span class="comment">		 * NEED a way to handle this or do not call it??</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		XAxiDma_Reset(AxiDmaInst);</span><br><span class="line"></span><br><span class="line">		TimeOut = RESET_TIMEOUT_COUNTER;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (TimeOut)</span><br><span class="line">		{</span><br><span class="line">			<span class="keyword">if</span> (XAxiDma_ResetIsDone(AxiDmaInst))</span><br><span class="line">			{</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			}</span><br><span class="line"></span><br><span class="line">			TimeOut -= <span class="number">1</span>;</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * If completion interrupt is asserted, then set RxDone flag</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">if</span> ((IrqStatus &amp; XAXIDMA_IRQ_IOC_MASK))</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		RxDone = <span class="number">1</span>;</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function setups the interrupt system so interrupts can occur for the</span></span><br><span class="line"><span class="comment"> * DMA, it assumes INTC component exists in the hardware system.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	IntcInstancePtr is a pointer to the instance of the INTC.</span></span><br><span class="line"><span class="comment"> * @param	AxiDmaPtr is a pointer to the instance of the DMA engine</span></span><br><span class="line"><span class="comment"> * @param	TxIntrId is the TX channel Interrupt ID.</span></span><br><span class="line"><span class="comment"> * @param	RxIntrId is the RX channel Interrupt ID.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> *		- XST_SUCCESS if successful,</span></span><br><span class="line"><span class="comment"> *		- XST_FAILURE.if not successful</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">SetupIntrSystem</span><span class="params">(INTC *IntcInstancePtr,</span></span><br><span class="line"><span class="params">						   XAxiDma *AxiDmaPtr, u16 TxIntrId, u16 RxIntrId)</span></span><br><span class="line">{</span><br><span class="line">	<span class="type">int</span> Status;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Initialize the interrupt controller and connect the ISRs */</span></span><br><span class="line">	Status = XIntc_Initialize(IntcInstancePtr, INTC_DEVICE_ID);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		xil_printf(<span class="string">"Failed init intc\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	Status = XIntc_Connect(IntcInstancePtr, TxIntrId,</span><br><span class="line">						   (XInterruptHandler)TxIntrHandler, AxiDmaPtr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		xil_printf(<span class="string">"Failed tx connect intc\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	Status = XIntc_Connect(IntcInstancePtr, RxIntrId,</span><br><span class="line">						   (XInterruptHandler)RxIntrHandler, AxiDmaPtr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		xil_printf(<span class="string">"Failed rx connect intc\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Start the interrupt controller */</span></span><br><span class="line">	Status = XIntc_Start(IntcInstancePtr, XIN_REAL_MODE);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line"></span><br><span class="line">		xil_printf(<span class="string">"Failed to start intc\r\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	XIntc_Enable(IntcInstancePtr, TxIntrId);</span><br><span class="line">	XIntc_Enable(IntcInstancePtr, RxIntrId);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"></span><br><span class="line">	XScuGic_Config *IntcConfig;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Initialize the interrupt controller driver so that it is ready to</span></span><br><span class="line"><span class="comment">	 * use.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	IntcConfig = XScuGic_LookupConfig(INTC_DEVICE_ID);</span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == IntcConfig)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	Status = XScuGic_CfgInitialize(IntcInstancePtr, IntcConfig,</span><br><span class="line">								   IntcConfig-&gt;CpuBaseAddress);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> XST_FAILURE;</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">//设置中断优先级和触发类型</span></span><br><span class="line">	XScuGic_SetPriorityTriggerType(IntcInstancePtr, TxIntrId, <span class="number">0xA0</span>, <span class="number">0x3</span>);</span><br><span class="line"></span><br><span class="line">	XScuGic_SetPriorityTriggerType(IntcInstancePtr, RxIntrId, <span class="number">0xA0</span>, <span class="number">0x3</span>);</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Connect the device driver handler that will be called when an</span></span><br><span class="line"><span class="comment">	 * interrupt for the device occurs, the handler defined above performs</span></span><br><span class="line"><span class="comment">	 * the specific interrupt processing for the device.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="comment">//设置中断处理函数</span></span><br><span class="line">	Status = XScuGic_Connect(IntcInstancePtr, TxIntrId,</span><br><span class="line">							 (Xil_InterruptHandler)TxIntrHandler,</span><br><span class="line">							 AxiDmaPtr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> Status;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	Status = XScuGic_Connect(IntcInstancePtr, RxIntrId,</span><br><span class="line">							 (Xil_InterruptHandler)RxIntrHandler,</span><br><span class="line">							 AxiDmaPtr);</span><br><span class="line">	<span class="keyword">if</span> (Status != XST_SUCCESS)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> Status;</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	XScuGic_Enable(IntcInstancePtr, TxIntrId);</span><br><span class="line">	XScuGic_Enable(IntcInstancePtr, RxIntrId);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Enable interrupts from the hardware */</span></span><br><span class="line"></span><br><span class="line">	Xil_ExceptionInit();</span><br><span class="line">	Xil_ExceptionRegisterHandler(XIL_EXCEPTION_ID_INT,</span><br><span class="line">								 (Xil_ExceptionHandler)INTC_HANDLER,</span><br><span class="line">								 (<span class="type">void</span> *)IntcInstancePtr);</span><br><span class="line"></span><br><span class="line">	Xil_ExceptionEnable();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> XST_SUCCESS;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*****************************************************************************/</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function disables the interrupts for DMA engine.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param	IntcInstancePtr is the pointer to the INTC component instance</span></span><br><span class="line"><span class="comment"> * @param	TxIntrId is interrupt ID associated w/ DMA TX channel</span></span><br><span class="line"><span class="comment"> * @param	RxIntrId is interrupt ID associated w/ DMA RX channel</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return	None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note		None.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> ******************************************************************************/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">DisableIntrSystem</span><span class="params">(INTC *IntcInstancePtr,</span></span><br><span class="line"><span class="params">							  u16 TxIntrId, u16 RxIntrId)</span></span><br><span class="line">{</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> XPAR_INTC_0_DEVICE_ID</span></span><br><span class="line">	<span class="comment">/* Disconnect the interrupts for the DMA TX and RX channels */</span></span><br><span class="line">	XIntc_Disconnect(IntcInstancePtr, TxIntrId);</span><br><span class="line">	XIntc_Disconnect(IntcInstancePtr, RxIntrId);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	XScuGic_Disconnect(IntcInstancePtr, TxIntrId);</span><br><span class="line">	XScuGic_Disconnect(IntcInstancePtr, RxIntrId);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-20T16:00:00.000Z" title="2025/1/21 00:00:00">2025-01-21</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-21T12:31:15.896Z" title="2025/1/21 20:31:15">2025-01-21</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">2 minutes lesen (Über 229 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/21/Verilog%E4%B8%ADif%E8%AF%AD%E5%8F%A5%E5%92%8Ccase%E8%AF%AD%E5%8F%A5%E7%BB%BC%E5%90%88%E5%87%BA%E7%9A%84%E7%94%B5%E8%B7%AF%E5%8C%BA%E5%88%AB/">Verilog中if语句和case语句综合出的电路区别</a></p><div class="content"><p>区别是 <code>if else</code> 的逻辑判断有优先级，最内层的 <code>if</code> 的优先级最高，<code>case</code> 的逻辑判断是并列的。<br>每个 <code>if else</code> 综合出来的电路是一个 2 选 1 选通器。当信号有明显优先级时使用该语句，但是 <code>if</code> 嵌套太多的话会导致路径延时过大，降低运行速度。所以在判定条件较少的时候使用。<code>if else</code> 综合出的电路面积较小。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501212020215.png" alt="|395"><br>case语句适用于无明显优先级的逻辑判断，这些逻辑条件都处于同一个优先级且互斥，比如实现对速度要求较高的编解码；case结构电路速度较快，但占用面积较大，综合为 n 选 1 mux电路。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501212021357.png" alt="|400"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-19T16:00:00.000Z" title="2025/1/20 00:00:00">2025-01-20</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-23T12:45:24.334Z" title="2025/1/23 20:45:24">2025-01-23</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">6 minutes lesen (Über 836 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/20/ZYNQ-IP-AXI-GPIO/">ZYNQ-IP-AXI-GPIO</a></p><div class="content"><p>AXI GPIO 可以将 PS 端的一个 AXI 4-Lite 接口转化为 GPIO 接口，并且可以被配置为单端口或双端口，每个通道的位宽可以独立配置。<br>通过使能三态门可以将端口动态地配置为输入或输出。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501202100505.png" alt="axigpio|500"><br>AXIGPIO 是 ZYNQ PL 端的一个 IP 核，可以将 AXI-Lite Master 转为 GPIO，并且一个 AXI-Lite 接口可以通过 AXI interconnect 模块控制多个 AXI-GPIO。</p>
<h1 id="AXI-GPIO-IP-设置"><a href="#AXI-GPIO-IP-设置" class="headerlink" title="AXI-GPIO IP 设置"></a>AXI-GPIO IP 设置</h1><h2 id="最大时钟频率"><a href="#最大时钟频率" class="headerlink" title="最大时钟频率"></a>最大时钟频率</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501221954976.png" alt="|500"><br><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="9.667ex" height="2.009ex" role="img" focusable="false" viewBox="0 -683 4273 888"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44D" d="M58 8Q58 23 64 35Q64 36 329 334T596 635L586 637Q575 637 512 637H500H476Q442 637 420 635T365 624T311 598T266 548T228 469Q227 466 226 463T224 458T223 453T222 450L221 448Q218 443 202 443Q185 443 182 453L214 561Q228 606 241 651Q249 679 253 681Q256 683 487 683H718Q723 678 723 675Q723 673 717 649Q189 54 188 52L185 49H274Q369 50 377 51Q452 60 500 100T579 247Q587 272 590 277T603 282H607Q628 282 628 271Q547 5 541 2Q538 0 300 0H124Q58 0 58 8Z"></path></g><g data-mml-node="mi" transform="translate(723,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1213,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1813,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mn" transform="translate(2273,0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(1000,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1500,0)"></path></g></g></g></svg></mjx-container> 的最大频率和 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="10.637ex" height="1.805ex" role="img" focusable="false" viewBox="0 -716 4701.4 798"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1201,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1562,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1907,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mn" transform="translate(2479,0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g><g data-mml-node="mo" transform="translate(3201.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(4201.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></svg></mjx-container> 的速率相同，为 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="8.833ex" height="1.595ex" role="img" focusable="false" viewBox="0 -683 3904 705"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mi" transform="translate(1500,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(2551,0)"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g><g data-mml-node="mi" transform="translate(3439,0)"><path data-c="1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></g></g></g></svg></mjx-container>。</p>
<h2 id="AXI-GPIO-设置"><a href="#AXI-GPIO-设置" class="headerlink" title="AXI GPIO 设置"></a>AXI GPIO 设置</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1737546785450.png" alt="AXIGPIOip|500"><br>默认为单通道。GPIO 的方向在这里设置了以后就不能在 vitis 中设置 GPIO 的方向。<br>中断属于 PL 对 PS 的中断，需要在 ZYNQ 7 Processing System 中勾选<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501222009101.png" alt="|500"></p>
<p>生成的 vitis 的代码中，<code>xparameters.h</code> 中的 id 默认从 ID 0 开始，不管 vivado 这边的 AXI-GPIO 的序号是从 0 开始还是从 1 开始。</p>
<blockquote>
<p>[!note]</p>
<ol>
<li>GPIO 只能使能整个通道中断，无法单独使能通道中的某个引脚中断</li>
<li><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501222014038.png" alt="|400"><br>中断类型只能设置为上升沿或高电平</li>
</ol>
</blockquote>
<h1 id="AXI-GPIO-相关代码"><a href="#AXI-GPIO-相关代码" class="headerlink" title="AXI-GPIO 相关代码"></a>AXI-GPIO 相关代码</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Initialize the XGpio instance provided by the caller based on the</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* given configuration data.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Nothing is done except to initialize the InstancePtr.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    InstancePtr is a pointer to an XGpio instance. The memory the</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       pointer references must be pre-allocated by the caller. Further</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       calls to manipulate the driver through the XGpio API must be</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       made with this pointer.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    Config is a reference to a structure containing information</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       about a specific GPIO device. This function initializes an</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       InstancePtr object for a specific device specified by the</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       contents of Config. This function can initialize multiple</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       instance objects with the use of multiple calls giving different</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       Config information on each call.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    EffectiveAddr is the device base address in the virtual memory</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       address space. The caller is responsible for keeping the address</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       mapping from EffectiveAddr to the device physical base address</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       unchanged once this function is invoked. Unexpected errors may</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       occur if the address mapping changes after this function is</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       called. If address translation is not used, use</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       Config-&gt;BaseAddress for this parameters, passing the physical</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       address instead.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @return</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       - XST_SUCCESS if the initialization is successful.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @note     None.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">XGpio_CfgInitialize</span><span class="params">(XGpio * InstancePtr, XGpio_Config * Config,</span></span><br><span class="line"><span class="params"></span></span><br><span class="line"><span class="params">            UINTPTR EffectiveAddr)</span></span><br></pre></td></tr></table></figure>
<h2 id="设置输入输出方向"><a href="#设置输入输出方向" class="headerlink" title="设置输入输出方向"></a>设置输入输出方向</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Set the input/output direction of all discrete signals for the specified</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* GPIO channel.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @param    InstancePtr is a pointer to an XGpio instance to be worked on.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    Channel contains the channel of the GPIO (1 or 2) to operate on.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    DirectionMask is a bitmask specifying which discretes are input</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       and which are output. Bits set to 0 are output and bits set to 1</span></span><br><span class="line"><span class="comment">*       are input.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @return   None.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @note     The hardware must be built for dual channels if this function</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       is used with any channel other than 1.  If it is not, this</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       function will assert.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">XGpio_SetDataDirection</span><span class="params">(XGpio *InstancePtr, <span class="type">unsigned</span> Channel, u32 DirectionMask)</span></span><br></pre></td></tr></table></figure>
<h2 id="GPIO-读写"><a href="#GPIO-读写" class="headerlink" title="GPIO 读写"></a>GPIO 读写</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Read state of discretes for the specified GPIO channel.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    InstancePtr is a pointer to an XGpio instance to be worked on.</span></span><br><span class="line"><span class="comment">* @param    Channel contains the channel of the GPIO (1 or 2) to operate on.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @return   Current copy of the discretes register.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @note     The hardware must be built for dual channels if this function</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       is used with any channel other than 1.  If it is not, this</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       function will assert.</span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line">u32 <span class="title function_">XGpio_DiscreteRead</span><span class="params">(XGpio * InstancePtr, <span class="type">unsigned</span> Channel)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Write to discretes register for the specified GPIO channel.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    InstancePtr is a pointer to an XGpio instance to be worked on.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    Channel contains the channel of the GPIO (1 or 2) to operate on.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @param    Mask is the value to be written to the discretes register.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @return   None.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* @note     The hardware must be built for dual channels if this function</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       is  used with any channel other than 1.  If it is not, this</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       function will assert. See also XGpio_DiscreteSet() and</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*       XGpio_DiscreteClear().</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*****************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">XGpio_DiscreteWrite</span><span class="params">(XGpio * InstancePtr, <span class="type">unsigned</span> Channel, u32 Mask)</span></span><br></pre></td></tr></table></figure>




</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-19T16:00:00.000Z" title="2025/1/20 00:00:00">2025-01-20</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T12:47:21.312Z" title="2025/1/20 20:47:21">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">9 minutes lesen (Über 1365 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/20/ZYNQ%E4%B8%AD%E7%9A%84IO/">ZYNQ中的GPIO</a></p><div class="content"><h1 id="GPIO-原理"><a href="#GPIO-原理" class="headerlink" title="GPIO 原理"></a>GPIO 原理</h1><p>GPIO 通过 MIO 提供 54 路接口，其中 16 路位于 bank 500，剩余位于 bank 501。还通过 EMIO 接口提供从 PL 来的 64 路输入和 128 路输出。GPIO 控制和状态寄存器内存映射在基址 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.345ex;" xmlns="http://www.w3.org/2000/svg" width="12.329ex" height="1.884ex" role="img" focusable="false" viewBox="0 -680 5449.3 832.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mi" transform="translate(500,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1072,0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="msub" transform="translate(1836,0)"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g><g data-mml-node="mi" transform="translate(1533,-152.7) scale(0.707)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g></g><g data-mml-node="mn" transform="translate(3949.3,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(1000,0)"></path></g></g></g></svg></mjx-container>。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1736500884874.png" alt="500"><br>ZYNQ 的 GPIO 引脚分为 4 个 bank，共有 118 个 GPIO。<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="107.287ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 47420.9 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(1000,0)"></path></g><g data-mml-node="mi" transform="translate(1500,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(2500,0)"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(3286,0)"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(4037,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(4541,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mo" transform="translate(5581.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(6637.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(7637.6,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(8637.6,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(9688.6,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(10192.6,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mi" transform="translate(10955.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">（</text></g><g data-mml-node="mi" transform="translate(11955.6,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(12384.6,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(12913.6,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(13513.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(14034.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mi" transform="translate(14534.6,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">）</text></g><g data-mml-node="mo" transform="translate(15756.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(16757,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(17757,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(18757,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(19808,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(20312,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mi" transform="translate(21075,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">（</text></g><g data-mml-node="mi" transform="translate(22075,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(22504,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(23033,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(23633,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(24154,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(24654,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">）</text></g><g data-mml-node="mo" transform="translate(25876.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(26876.4,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(27876.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(28876.4,0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mi" transform="translate(29640.4,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(30691.4,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(31195.4,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mi" transform="translate(31958.4,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">（</text></g><g data-mml-node="mi" transform="translate(32958.4,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(33387.4,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(33916.4,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(34516.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(35037.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(35537.4,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">）</text></g><g data-mml-node="mo" transform="translate(36759.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(37759.9,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mi" transform="translate(38759.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">个</text></g><g data-mml-node="mi" transform="translate(39759.9,0)"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g><g data-mml-node="mi" transform="translate(40523.9,0)"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g><g data-mml-node="mi" transform="translate(41574.9,0)"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g><g data-mml-node="mi" transform="translate(42078.9,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g><g data-mml-node="mi" transform="translate(42841.9,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">（</text></g><g data-mml-node="mi" transform="translate(43841.9,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(44270.9,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(44799.9,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(45399.9,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mn" transform="translate(45920.9,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(46420.9,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">）</text></g></g></g></svg></mjx-container></p>
<h2 id="GPIO-内部结构"><a href="#GPIO-内部结构" class="headerlink" title="GPIO 内部结构"></a>GPIO 内部结构</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501101733911.png" alt="|450"><br>从图中可以看到 GPIO 有三个功能：输入、输出、中断。<br>其中 MIO 7 和 9 只能做输出。<br>一组寄存器只能控制一个 GPIO bank 的所有引脚。</p>
<h3 id="器件引脚的-GPIO-控制"><a href="#器件引脚的-GPIO-控制" class="headerlink" title="器件引脚的 GPIO 控制"></a>器件引脚的 GPIO 控制</h3><h3 id="输入-输出寄存器"><a href="#输入-输出寄存器" class="headerlink" title="输入/输出寄存器"></a>输入/输出寄存器</h3><table>
<thead>
<tr>
<th align="center">寄存器名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DATA_RO</td>
<td align="center">GPIO引脚的值存储在此寄存器中，无论GPIO被配置为输入或输出，都可以通过读此寄存器得到GPIO引脚的值。  <br>因为是只读寄存器（对软件来说），软件向此寄存器的写入操作将被忽略。</td>
</tr>
<tr>
<td align="center">DATA</td>
<td align="center">输出数据寄存器，当GPIO被配置为输出才起作用，此寄存器中的值就是输出到引脚的值。  <br>向此寄存器写入就是在设置GPIO的输出值，  <br>读此寄存器将返回GPIO前一时刻的输出值，而不是现在的值。</td>
</tr>
<tr>
<td align="center">MASK_DATA_LSW</td>
<td align="center">Mask Data Least Significant Words，输出数据低16位掩码寄存器，此寄存器只有低16位有效，  <br>对应位为1表示DATA寄存器低16位中对应位的值可以更改，  <br>若不为1，则表示DATA寄存器低16位中对应位保持原值</td>
</tr>
<tr>
<td align="center">MASK_DATA_MSW</td>
<td align="center">Mask Data Most Significant Words，输出数据高16位掩码寄存器，  <br>功能同MASK_DATA_LSW，只是它对应DATA寄存器高16位</td>
</tr>
<tr>
<td align="center">DIRM</td>
<td align="center">Direction Memory，方向寄存器，默认为0表示输入，设为1表示输出  <br>注意，即使DIRM为1，软件也可以像输入一样去读此引脚的电平</td>
</tr>
<tr>
<td align="center">OEN</td>
<td align="center">Output Enable，输出使能寄存器，  <br>仅当DIRM为0时有效，为1表示输出使能，  <br>为0表示输出不使能，此时对应引脚上的值为三态值</td>
</tr>
</tbody></table>
<h3 id="中断控制寄存器"><a href="#中断控制寄存器" class="headerlink" title="中断控制寄存器"></a>中断控制寄存器</h3><table>
<thead>
<tr>
<th align="center">寄存器名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">INT_TYPE</td>
<td align="center">Interrupt Type 中断类型寄存器，  <br>控制GPIO中断是电平触发还是边缘触发</td>
</tr>
<tr>
<td align="center">INT_POLARITY</td>
<td align="center">Interrupt Polarity 中断极性寄存器  <br>控制GPIO中断是低电平/下降沿有效，还是高电平/上升沿有效</td>
</tr>
<tr>
<td align="center">INT_ANY</td>
<td align="center">Interrupt Any，双边沿寄存器，  <br>仅当INT_TYPE为边沿触发时，此寄存器才有效，控制是否双沿均可触发中断</td>
</tr>
<tr>
<td align="center">INT_STAT</td>
<td align="center">Interrupt State，中断状态寄存器，  <br>此寄存器的值会被与之相连的INT State D触发器读取  <br>D触发器存储中断状态，软件通过读此D触发器输出来判断中断是否发生，  <br>清除此D触发器来清除中断状态</td>
</tr>
<tr>
<td align="center">INT_MASK</td>
<td align="center">Interrupt Mask，中断掩码寄存器，  <br>显示当前哪些位被屏蔽，哪些位启用</td>
</tr>
<tr>
<td align="center">INT_DIS</td>
<td align="center">Interrupt Disable，中断失效寄存器，  <br>向该寄存器的任何位写入 1 都会屏蔽该中断信号。  <br>从该寄存器读取会返回不可预测的值</td>
</tr>
<tr>
<td align="center">INT_EN</td>
<td align="center">Interrupt Enable，中断使能寄存器  <br>向该寄存器的任何位写入 1，可以启用/解除中断信号的掩码。  <br>从该寄存器读取将返回一个不不可预测的值</td>
</tr>
</tbody></table>
<p>GPIO 的中断号为 ==52==，中断优先级是固定的，无需配置 GPIO 的中断优先级。GPIO 所有引脚共享同一个中断，即使能两个引脚的中断的话，软件无法判断中断来自哪个引脚。</p>
<h1 id="EMIO-和-MIO"><a href="#EMIO-和-MIO" class="headerlink" title="EMIO 和 MIO"></a>EMIO 和 MIO</h1><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501201743362.png" alt="MIO EMIO|500"><br>MIO，Multiuse I/O，复用输入/输出，对应 PS 端的可配置的多功能引脚。<br>EMIO，Extent MIO，对应 PL 端的可配置多功能引脚。<br>MIO 是外设的基本引脚，由于 MIO 的引脚数量较少，ZYNQ 也提供 EMIO 接口作为 MIO 的扩展，外设通过 EMIO 接口连接到 PL 端的引脚，来实现和 MIO 几乎相同的功能。<br>MIO 和 EMIO 的不同点如下：</p>
<ol>
<li>MIO 对于 PL 端是透明的，PL 无法读取 MIO 引脚上的电平；PS 端可以通过 EMIO 与 PL 端通信。</li>
<li>外设与 MIO 是固定搭配的，初始化时要根据开发板原理图来选择引脚约束。EMIO 相对灵活，引脚可以任意指定，通过 xdc 文件约束指定到 PL 端的某个引脚。</li>
<li>因为 MIO 引脚更靠近外围电路，相较于 EMIO，一些外设使用 MIO 的性能更好，还有一些外设只能使用 MIO。<br> <img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501201753826.png" alt="|450"></li>
</ol>
<h1 id="MIO-bank-和封装的-bank-的区别与联系"><a href="#MIO-bank-和封装的-bank-的区别与联系" class="headerlink" title="MIO bank 和封装的 bank 的区别与联系"></a>MIO bank 和封装的 bank 的区别与联系</h1><p>MIO 分为 Bank 0 和 Bank 1，Bank 0 是封装 Bank 500 中的部分引脚，Bank 1 是封装的 bank 501 的部分引脚。<br>Bank 0 包含 MIO 0<del>15 共 16 个 MIO，bank 1 包括 MIO 16</del>53 共 38 个 MIO，总共有 54 个 MIO。EMIO 一共有 64 个。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202501201804605.png" alt="|550"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-19T13:11:17.810Z" title="2025/1/19 21:11:17">2025-01-19</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-21T07:12:57.886Z" title="2025/1/21 15:12:57">2025-01-21</time></span><span class="level-item">3 minutes lesen (Über 416 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/19/%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E8%B5%8B%E5%80%BC/">阻塞赋值和非阻塞赋值</a></p><div class="content"><h1 id="阻塞和非阻塞的区别"><a href="#阻塞和非阻塞的区别" class="headerlink" title="阻塞和非阻塞的区别"></a>阻塞和非阻塞的区别</h1><h2 id="阻塞赋值“-”"><a href="#阻塞赋值“-”" class="headerlink" title="阻塞赋值“&#x3D;”"></a>阻塞赋值“&#x3D;”</h2><p>必须是阻塞赋值完成后，才进行下一条语句的执行；赋值一旦完成，等号左边的变量值立即变化。在同一个块中，阻塞赋值表达式的书写顺序会影响赋值的结果。硬件没有对应的电路。</p>
<blockquote>
<p>即串行赋值，语句从上到下顺序执行，立即生效</p>
</blockquote>
<h2 id="非阻塞赋值“"><a href="#非阻塞赋值“" class="headerlink" title="非阻塞赋值“&lt;&#x3D;”"></a>非阻塞赋值“&lt;&#x3D;”</h2><p>在赋值开始时计算表达式右边的值，在本次仿真周期时钟的下降沿时才更新被赋值变量，即赋值不是立即生效的；非阻塞赋值允许块中其他语句同时执行。在同一个块中，非阻塞赋值表达式的书写顺序不影响赋值的结果。硬件有对应的电路。</p>
<blockquote>
<p>并行执行，不是立即生效，语句同时执行</p>
</blockquote>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>阻塞赋值对应的硬件电路与时钟触发沿没有关系，只和输入的电平变化有关；阻塞赋值对应触发器，只有触发沿才会发生赋值。</p>
<ol>
<li>时序电路建模时，用非阻塞赋值</li>
<li>锁存器建模时，用非阻塞赋值</li>
<li>在 always 块中建立组合逻辑时，用阻塞赋值</li>
<li>在同一个 always 块中建立时序和组合逻辑时，用非阻塞</li>
<li>在同一个 always 块中不能既用阻塞又用非阻塞</li>
<li>不要在一个以上的always块中为同一个变量赋值</li>
<li>赋值时不能延时</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-19T13:11:17.795Z" title="2025/1/19 21:11:17">2025-01-19</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:38:40.272Z" title="2025/1/20 10:38:40">2025-01-20</time></span><span class="level-item">7 minutes lesen (Über 981 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/19/Testbench%E4%BB%BF%E7%9C%9F%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E6%8C%87%E5%8C%97/">Testbench仿真脚本编写指北</a></p><div class="content"><blockquote>
<p>[!note]<br>由于 Quartus 的 VWF 仿真只能仿真很短的时间，而且 Vivado 仿真的时候也需要添加激励信号，因此需要编写 testbench 文件进行激励仿真。</p>
</blockquote>
<h1 id="Testbench-文件结构"><a href="#Testbench-文件结构" class="headerlink" title="Testbench 文件结构"></a>Testbench 文件结构</h1><p>编写 testbench 的目的是为了测试 module 的功能、性能是否符合设计的预期。验证设计的功能包括以下步骤：</p>
<ol>
<li>产生合适的激励波形：该激励通常要覆盖被测 HDL 模块所有可能产生的输入状态；</li>
<li>将产生的激励信号加入到 DUT 中并观察其响应：即将 DUT 模块例化的 Testbench 中，运行仿真测试；</li>
<li>将输出的响应与期望值比较。<br>Testbench 的结构一般模块如下：<br>&#96;&#96;</li>
</ol>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Test_bench_name();</span><br><span class="line"><span class="comment">// 01:信号或变量声明定义</span></span><br><span class="line"><span class="comment">// --逻辑设计中输入对应 reg 型</span></span><br><span class="line"><span class="comment">// --逻辑设计中输出对应 wire 型</span></span><br><span class="line"><span class="comment">// 02:使用 ini[ti](https://bbs.elecfans.com/group_715)al 或 always 语句产生激励</span></span><br><span class="line"><span class="comment">// 03:例化待测试DUT模块</span></span><br><span class="line"><span class="comment">// 04:监控和比较输出响应</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><h2 id="时钟激励输入示例"><a href="#时钟激励输入示例" class="headerlink" title="时钟激励输入示例"></a>时钟激励输入示例</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">时钟激励产生方法一：50%占空比时钟</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">parameter</span> ClockPeriod=<span class="number">10</span>; <span class="comment">//参数化时钟周期</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    clk_i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">forever</span><span class="variable">#(ClockPeriod/2)</span> clk_i = ~clk_i;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">时钟激励产生方法二：50%占空比时钟</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  clk_i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">always</span> <span class="variable">#(ClockPeriod/2)</span> clk_i=~clk_i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">时钟激励产生方法三：产生固定数量的时钟脉冲</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">parameter</span> ClockPeriod=<span class="number">10</span>; <span class="comment">//参数化时钟周期</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  clk_i=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">repeat</span>(<span class="number">6</span>)</span><br><span class="line">  <span class="variable">#(ClockPeriod/2)</span> clk_i=~clk_i;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------------------------------------------------------------</span></span><br><span class="line"><span class="comment">时钟激励产生方法四：产生非占空比为 50%的时钟</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">parameter</span> ClockPeriod=<span class="number">10</span>; <span class="comment">//参数化时钟周期</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">clk_i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">forever</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="variable">#((ClockPeriod/2)-2)</span> clk_i=<span class="number">0</span>;</span><br><span class="line">    <span class="variable">#((ClockPeriod/2)+2)</span> clk_i=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="复位激励输入示例"><a href="#复位激励输入示例" class="headerlink" title="复位激励输入示例"></a>复位激励输入示例</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------------------------------------------- </span></span><br><span class="line"><span class="comment">复位信号产生方法一：异步复位</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  [rs](https:<span class="comment">//www.elecfans.com/tags/rs/)t_n_i=1;</span></span><br><span class="line">  #<span class="number">100</span>; rst_n_i=<span class="number">0</span>;</span><br><span class="line">  #<span class="number">100</span>; rst_n_i=<span class="number">1</span>; </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">/*---------------------------------------------------------------- </span></span><br><span class="line"><span class="comment">复位信号产生方法二：同步复位</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">initial</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  rst_n_i=<span class="number">1</span>; clk_i = <span class="number">0</span>;</span><br><span class="line">  @（<span class="keyword">negedge</span> clk_i)</span><br><span class="line">  rst_n_i=<span class="number">0</span>;</span><br><span class="line">  #<span class="number">100</span>; <span class="comment">//固定时间复位</span></span><br><span class="line">  <span class="keyword">repeat</span>(<span class="number">10</span>) @（<span class="keyword">negedge</span> clk_i); <span class="comment">//固定周期数复位</span></span><br><span class="line">  @（<span class="keyword">negedge</span> clk_i)</span><br><span class="line">  rst_n_i=<span class="number">1</span>; </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">always</span> #<span class="number">5</span> clk_i=~clk_i;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------------------------------------------------------- </span></span><br><span class="line"><span class="comment">复位信号产生方法三：复位任务封装</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">task</span> reset;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] reset_time; <span class="comment">//复位时间可调，输入复位时间</span></span><br><span class="line">  RST_ING=<span class="number">0</span>; <span class="comment">//复位方式可调，低电平或高电平</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    rst_n=RST_ING; <span class="comment">//复位中</span></span><br><span class="line">    #reset_time; <span class="comment">//复位时间</span></span><br><span class="line">    rst_n_i=~RST_ING; <span class="comment">//撤销复位，复位结束</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endtask</span></span><br></pre></td></tr></table></figure>
<h2 id="仿真控制语句和系统任务描述"><a href="#仿真控制语句和系统任务描述" class="headerlink" title="仿真控制语句和系统任务描述"></a>仿真控制语句和系统任务描述</h2><p>&#96;&#96;</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------------------------------------------- </span></span><br><span class="line"><span class="comment">仿真控制语句及系统任务描述</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="built_in">$stop</span>  <span class="comment">// 停止运行仿真，modelsim 中可继续仿真</span></span><br><span class="line"><span class="built_in">$stop</span>(n) <span class="comment">//带参数系统任务，根据参数 0,1或2不同，输出仿真信息</span></span><br><span class="line"><span class="built_in">$finish</span> <span class="comment">//结束运行仿真，不可继续仿真</span></span><br><span class="line"><span class="built_in">$finish</span>(n) <span class="comment">//带参数系统任务，根据参数 0,1或2不同，输出仿真信息</span></span><br><span class="line"><span class="comment">//0:不输出任何信息</span></span><br><span class="line"><span class="comment">//1:输出当前仿真时刻和位置</span></span><br><span class="line"><span class="comment">//2:输出当前仿真时刻、位置和仿真过程中用到的 memory 以及 CPU 时间的统计</span></span><br><span class="line"><span class="built_in">$random</span> <span class="comment">//产生随机数</span></span><br><span class="line"><span class="built_in">$random</span> % n <span class="comment">//产生范围-n 到 n 之间的随机数</span></span><br><span class="line">&#123;<span class="built_in">$random</span>&#125; % n <span class="comment">//产生范围 0 到 n 之间的随机数</span></span><br><span class="line"><span class="comment">/*----------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<h2 id="文本读取"><a href="#文本读取" class="headerlink" title="文本读取"></a>文本读取</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------------------------------------------- </span></span><br><span class="line"><span class="comment">文本输入方式：$readmemb/$readmemh</span></span><br><span class="line"><span class="comment">----------------------------------------------------------------*/</span></span><br><span class="line"><span class="built_in">$readmemb</span>/<span class="built_in">$readmemh</span>(<span class="string">&quot;&lt;数据文件名&gt;&quot;</span>,&lt;存储器名&gt;);</span><br><span class="line"><span class="built_in">$readmemb</span>/<span class="built_in">$readmemh</span>(<span class="string">&quot;&lt;数据文件名&gt;&quot;</span>,&lt;存储器名&gt;,&lt;起始地址&gt;);</span><br><span class="line"><span class="built_in">$readmemb</span>/<span class="built_in">$readmemh</span>(<span class="string">&quot;&lt;数据文件名&gt;&quot;</span>,&lt;存储器名&gt;,&lt;起始地址&gt;,&lt;结束地址&gt;);</span><br><span class="line"><span class="built_in">$readmemb</span>:<span class="comment">/*读取二进制数据，读取文件内容只能包含：空白位置，注释行，二进制数</span></span><br><span class="line"><span class="comment">数据中不能包含位宽说明和格式说明，每个数字必须是二进制数字。*/</span></span><br><span class="line"><span class="built_in">$readmemh</span>:<span class="comment">/*读取十六进制数据，读取文件内容只能包含：空白位置，注释行，十六进制数</span></span><br><span class="line"><span class="comment">数据中不能包含位宽说明和格式说明，每个数字必须是十六进制数字。*/</span></span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2025-01-14T16:00:00.000Z" title="2025/1/15 00:00:00">2025-01-15</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:38:28.110Z" title="2025/1/20 10:38:28">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">a few seconds lesen (Über 49 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2025/01/15/Vitis%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF/">Vitis开发过程中遇到的错误</a></p><div class="content"><h1 id="Error-while-launching-program-Memory-write-error-at-0-x-105000-MMU-section-translation-fault"><a href="#Error-while-launching-program-Memory-write-error-at-0-x-105000-MMU-section-translation-fault" class="headerlink" title="Error while launching program: Memory write error at 0 x 105000. MMU section translation fault"></a>Error while launching program: Memory write error at 0 x 105000. MMU section translation fault</h1><p>没找到具体原因。<br>先生成 boot. Bin 文件烧录到内存卡后再启动 zynq 就不会出现这个报错。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-12-28T16:00:00.000Z" title="2024/12/29 00:00:00">2024-12-29</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:46:48.748Z" title="2025/1/20 10:46:48">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">5 minutes lesen (Über 755 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/29/FIR%E6%BB%A4%E6%B3%A2%E5%99%A8%E7%9A%84%E6%9E%B6%E6%9E%84/">FIR滤波器的架构</a></p><div class="content"><h1 id="数学基础"><a href="#数学基础" class="headerlink" title="数学基础"></a>数学基础</h1><p>有限脉冲响应滤波器，其突出特点为单位取样响应 $h(n)$ 是一个 N 点长的有限序列，滤波器的输出 $y(n)$ 表示为输入序列 $x(n)$ 和 $h(n)$ 的线性卷积<br>$$<br>y(n)&#x3D;\sum_{k&#x3D;0}^{N-1}x(k)h(n-k)&#x3D;x(n)*h(n)<br>$$<br>系统函数为<br>$$<br>H(z)&#x3D;\sum_{n&#x3D;0}^{N-1}h(n)z^{-n}&#x3D;h(0)+h(1)z^{-1}+\cdots+h(N-1)z^{-(N-1)}<br>$$<br>由此可见 FIR 只在原点上存在极点，具有全局稳定性<br>不同阶数的 FIR 滤波器特性</p>
<table>
<thead>
<tr>
<th>单位取样响应特征</th>
<th>滤波器种类</th>
</tr>
</thead>
<tbody><tr>
<td>系数偶对称，阶数为偶数</td>
<td>适合各种滤波器</td>
</tr>
<tr>
<td>系数偶对称，阶数为奇数</td>
<td>不适合高通和带阻滤波器</td>
</tr>
<tr>
<td>系数奇对称，阶数为偶数</td>
<td>只适合带通滤波器</td>
</tr>
<tr>
<td>系数奇对称，阶数为奇数</td>
<td>适合高通和带通滤波器</td>
</tr>
</tbody></table>
<h2 id="系数量化"><a href="#系数量化" class="headerlink" title="系数量化"></a>系数量化</h2><p>将一组数据先进行归一化处理，再乘上一个整数因子，最后进行四舍五入截尾处理即可</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h = <span class="built_in">round</span>(h/<span class="built_in">max</span>(<span class="built_in">abs</span>(h))*(<span class="number">2</span>^N<span class="number">-1</span>)) //N为量化位数</span><br></pre></td></tr></table></figure>
<h1 id="Fully-Parallel-Systolic-Architecture（全并行脉动结构）"><a href="#Fully-Parallel-Systolic-Architecture（全并行脉动结构）" class="headerlink" title="Fully Parallel Systolic Architecture（全并行脉动结构）"></a>Fully Parallel Systolic Architecture（全并行脉动结构）</h1><p>全并行脉动滤波器对对称系数、反对称系数和零值系数进行了优化。滤波器的时延受到滤波器系数的对称性影响。<br>当对称系数绝对相等时，它们共享同一个 DSP block。这种配对共享允许在实现的过程中使用 Xilinx 和 Altera 的 dsp block 中的 pre-adder。<br>对称的滤波器如果不适用对称系数优化架构的话，结构如下图的上半部分，优化后为下半部分：<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412292142810.png" alt="fir_arch_systolic_sym.png|500"></p>
<h1 id="Fully-Parallel-Transposed-Architecture（全并行转置结构）"><a href="#Fully-Parallel-Transposed-Architecture（全并行转置结构）" class="headerlink" title="Fully Parallel Transposed Architecture（全并行转置结构）"></a>Fully Parallel Transposed Architecture（全并行转置结构）</h1><p>Fully Parallel Transposed Architecture 通过为任意的绝对相等的系数共享乘法器，同时移除零值系数所需的乘法器。此结构的滤波器时延为固定的 6 个 clk。<br>下图的上半部分是没有优化的部分对称滤波器，下半部分为优化后的结构：<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412292146523.png" alt="fir_arch_transposed_sym.png|500"></p>
<h1 id="Partly-Serial-Systolic-Architecture-1"><a href="#Partly-Serial-Systolic-Architecture-1" class="headerlink" title="Partly Serial Systolic Architecture (1 &lt; N &lt; L)"></a>Partly Serial Systolic Architecture (1 &lt; N &lt; L)</h1><p>其中 N 为延时长度，L 为滤波器阶数。<br>部分串行滤波器需要 <code>M=ceil(L/N)</code> 个脉动单元，结构如下：<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412292149737.png" alt="fir_arch_systolic_partly_serial.png|500"><br>滤波器的时延为 <code>M+ceil(L/M)+5</code>。<br>如果一个乘法器对应的查找表里面的系数为 0 或者 2 的幂次，则实现过程不包含乘法器，通过移位来实现幂次的变化。</p>
<h1 id="Fully-Serial-Systolic-Architecture-N-≥-L"><a href="#Fully-Serial-Systolic-Architecture-N-≥-L" class="headerlink" title="Fully Serial Systolic Architecture (N ≥ L)"></a>Fully Serial Systolic Architecture (N ≥ L)</h1><p>如果延时的长度大于滤波器的阶数，此时滤波器为全串行结构。滤波器延时为 $L+5$。<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412292156578.png" alt="fir_arch_systolic_fully_serial.png|500"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-12-27T16:00:00.000Z" title="2024/12/28 00:00:00">2024-12-28</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:39:01.050Z" title="2025/1/20 10:39:01">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">a few seconds lesen (Über 102 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/12/28/Quartus%E6%8A%A5%E9%94%99%E8%AE%B0%E5%BD%95/">Quartus报错记录</a></p><div class="content"><h1 id="Error-176310-Can’t-place-multiple-pins-assigned-to-pin-location-Pin-F-16-IOPAD-X-34-Y-18-N-21"><a href="#Error-176310-Can’t-place-multiple-pins-assigned-to-pin-location-Pin-F-16-IOPAD-X-34-Y-18-N-21" class="headerlink" title="Error (176310): Can’t place multiple pins assigned to pin location Pin_F 16 (IOPAD_X 34_Y 18_N 21)"></a>Error (176310): Can’t place multiple pins assigned to pin location Pin_F 16 (IOPAD_X 34_Y 18_N 21)</h1><p>报错如下<br><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412282018135.png"><br>可以看到 Pin_F 16 既被用于 DAC_DATA，又被用于 nCEO 引脚，因此才会报错不能将多个引脚赋到 Pin_F 16 上。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202412282020011.png"><br>将nCEO 的 value 设置为 Use as regual I&#x2F;O 即可解决问题。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-11-15T16:00:00.000Z" title="2024/11/16 00:00:00">2024-11-16</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:45:22.510Z" title="2025/1/20 10:45:22">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/%E7%94%B5%E8%B7%AF/">电路</a></span><span class="level-item">3 minutes lesen (Über 491 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/11/16/FPGA%E4%B8%AD%E7%9A%84%E7%94%B5%E5%B9%B3%E6%A0%87%E5%87%86/">FPGA中的电平标准</a></p><div class="content"><p>FPGA 在与外界进行信息交换时，为了确保信息的正确性，发送和接收信息都要对信息有认定的标准。在数字电路中，我们常用电压高低来表示“0”和“1”，那么多高的电压才会被当作“1”呢，这个时候就需要一个标准，这个标准就是电平标准。 </p>
<h1 id="常见电平标准"><a href="#常见电平标准" class="headerlink" title="常见电平标准"></a>常见电平标准</h1><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202411141024162.png"></p>
<h2 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h2><p>TTL (Transistor - Transistor Logic，三极管 - 三极管逻辑电平) 是电平标准中的元老级成员。<br>在早期的数字电路中有广泛的应用，但是它有一些缺点，比如高电平的判决门限和供电电压之间的电压空间较大，容易造成信号的不稳定性；而且 5 V 的电压过于耗电。</p>
<h2 id="LVTTL"><a href="#LVTTL" class="headerlink" title="LVTTL"></a>LVTTL</h2><p>LVTTL（Low Voltage Transistor - Transistor Logic，低压 TTL 电平标准）改进了 TTL 的缺点，将供电电压改为了 $3.3V$，功耗也相应降低了，而且提升了信号稳定性。</p>
<h2 id="CMOS"><a href="#CMOS" class="headerlink" title="CMOS"></a>CMOS</h2><p>CMOS（Complementary Metal Oxide Semiconductor，互补金属氧化物半导体电平）的特点是功耗较低，可以根据电路的工作状态自动调整功耗。</p>
<h2 id="LVCMOS"><a href="#LVCMOS" class="headerlink" title="LVCMOS"></a>LVCMOS</h2><p>LVCMOS（Low Voltage Complementary Metal Oxide Semiconductor，低压 CMOS 电平标准）在 CMOS 的基础上进一步降低供电电压，降低功耗。LVCMOS 在低功耗、中低速数字电路中非常受欢迎。</p>
<h2 id="LVDS"><a href="#LVDS" class="headerlink" title="LVDS"></a>LVDS</h2><p>LVDS，全称是Low Voltage Differential Signaling，是一种利用低压差分信号传输高速信号的电平标准，有低压，低功耗，噪声抑制能力强的特点。LVDS 的输出电压摆幅极小，只有 $\pm 350mV$，电流只有 $3.5mA$ 左右。由于其超低功耗和超快数据传输速率，常用于高速数据传输。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-09-20T16:00:00.000Z" title="2024/9/21 00:00:00">2024-09-21</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-19T14:18:34.611Z" title="2025/1/19 22:18:34">2025-01-19</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">9 minutes lesen (Über 1361 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/09/21/HDL%20coder%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">HDL coder使用手册</a></p><div class="content"><blockquote>
<p>💡 由于本科毕设女朋友准备使用FPGA完成，因此写这篇文章帮助她快速上手HDL coder的使用，降低前期入门的难度。</p>
</blockquote>
<h1 id="支持生成HDL代码的simulink库"><a href="#支持生成HDL代码的simulink库" class="headerlink" title="支持生成HDL代码的simulink库"></a>支持生成HDL代码的simulink库</h1><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211041121.png" alt="2024after4202409211041121.png"></p>
<p>名字中含有HDL的库中的模块一般都可以用来生成HDL代码。直接搜索模块名称，比如搜索fir，</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211050982.png" alt="2024after4202409211050982.png"></p>
<p>可以看到旁边会显示位于哪个库中，模块有可能位于多个库，只要有一个库的名字里面有HDL，就代表这个模块可以用来生成HDL代码。</p>
<h1 id="一些常用操作"><a href="#一些常用操作" class="headerlink" title="一些常用操作"></a>一些常用操作</h1><h2 id="创建子系统"><a href="#创建子系统" class="headerlink" title="创建子系统"></a>创建子系统</h2><p>将库中的模块拖到主界面组合好后，可能会占据很大的空间，如果工程较大，模块越连越多就特别臃肿，因此当我们完成某个功能以后，就可以将这部分的模块全部选中，此时右下角会出现三个点，将鼠标移到上面后会展开，出现很多不同的功能。下图是一个AM调制的过程，可以看到选中所有相关的模块后点击创建子系统，即可得到右图的子系统。刚生成的子系统的命名为subsystem，可以将命名改为更清晰易懂的名字。</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211056583.png" alt="2024after4202409211056583.png"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726887497741.png" alt="1726887497741.png"></p>
<h2 id="观察节点的信号波形"><a href="#观察节点的信号波形" class="headerlink" title="观察节点的信号波形"></a>观察节点的信号波形</h2><p>当选中某根连线时，同样会出现三个点，鼠标移动到上面后会展开，选择WiFi形状的选项即可记录该连线上的信号。运行仿真后再次点击WiFi图标即可打开逻辑分析仪，即可查看该连线上的信号。</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726888515922.png" alt="1726888515922.png"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726889009858.png" alt="1726889009858.png"></p>
<p>逻辑分析仪内部选中某个信号后即可在波形中调节数制、高度等设置。</p>
<blockquote>
<p>也可以使用scope模板看节点信号。</p>
</blockquote>
<h2 id="频谱分析"><a href="#频谱分析" class="headerlink" title="频谱分析"></a>频谱分析</h2><p>使用Spectrum Analyzer模块进行频谱分析。</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211127829.png" alt="2024after4202409211127829.png"></p>
<p>当样点比较少的时候可以将估计方法改为welch。</p>
<h2 id="信号数据格式显示"><a href="#信号数据格式显示" class="headerlink" title="信号数据格式显示"></a>信号数据格式显示</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211131120.png" alt="2024after4202409211131120.png"></p>
<p>可以显示模块输入输出信号的数据类型和小数位数。</p>
<blockquote>
<p>采样时间一栏中的时间图例选中以后，会用不同的颜色显示不同采样速率的模块，在多速率系统设计中有很大的用处。</p>
</blockquote>
<h1 id="生成HDL代码"><a href="#生成HDL代码" class="headerlink" title="生成HDL代码"></a>生成HDL代码</h1><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="设置诊断类型"><a href="#设置诊断类型" class="headerlink" title="设置诊断类型"></a>设置诊断类型</h3><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211138607.png" alt="2024after4202409211138607.png"></p>
<p>模型设置中选择诊断&#x2F;采样时间</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211139629.png" alt="2024after4202409211139629.png"></p>
<p>单任务和多任务数据传输必须设置成错误。</p>
<h3 id="兼容性检测"><a href="#兼容性检测" class="headerlink" title="兼容性检测"></a>兼容性检测</h3><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211145908.png" alt="2024after4202409211145908.png"></p>
<p>选择代码生成的目标文件夹，运行兼容性检查器，如果工程没有问题的话会出现如下界面</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726890374067.png" alt="1726890374067.png"></p>
<h3 id="目标平台选择"><a href="#目标平台选择" class="headerlink" title="目标平台选择"></a>目标平台选择</h3><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211148557.png" alt="2024after4202409211148557.png"></p>
<p>根据使用的FPGA选择综合工具和FPGA的系列。</p>
<h3 id="模块设置"><a href="#模块设置" class="headerlink" title="模块设置"></a>模块设置</h3><p>在要生成代码的子系统上右键，选择HDL模块属性：</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211151201.png" alt="2024after4202409211151201.png"></p>
<p>可以对流水线、乘法器等参数进行设置</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726890814415.png" alt="1726890814415.png"></p>
<blockquote>
<p>如果生成的代码在EDA工具中编译以后无法满足时序约束，可以加输入和输出的流水线</p>
</blockquote>
<blockquote>
<p>💡 如果模块的输出对前面的模块有反馈信号的话不能添加流水线，详细见<br><a target="_blank" rel="noopener" href="https://blog.sawenmoerjie.top/article/ec96aebc-b5a5-4059-bbef-02f0003e7a45">bookmark</a></p>
</blockquote>
<pre><code>[bookmark](https://blog.sawenmoerjie.top/article/ec96aebc-b5a5-4059-bbef-02f0003e7a45)
</code></pre>
<h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211154140.png" alt="2024after4202409211154140.png"></p>
<p>点击为子系统生成HDL代码后会自动进行一次编译，命令行窗口会出现如下信息</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1726891451673.png" alt="1726891451673.png"></p>
<p>同时会生成一个report</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211206344.png" alt="2024after4202409211206344.png"></p>
<p>没有报错的话即可在上面选择的文件夹里面看到生成的Verilog代码文件</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202409211207218.png" alt="2024after4202409211207218.png"></p>
<p>将这些文件导入到EDA工具中即可直接例化使用。</p>
<blockquote>
<p>💡 所有文件都要导入，不能只导入需要的某个名字的模块！</p>
</blockquote>
<blockquote>
<p>💡 一定要看EDA软件编译后的报告，尤其是大型设计，很容易不满足时序要求，这个时候就要回去simulink里面优化设计，如果时序报告里面是A模块的某个地方时序满足不了要求，那么就要在simulink中在A模块中添加流水线。（注：Quartus中我没有遇见过时序报错的，可能是没有在Quartus中开发大工程）</p>
</blockquote>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-07-22T16:00:00.000Z" title="2024/7/23 00:00:00">2024-07-23</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T09:16:01.546Z" title="2025/1/20 17:16:01">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">a minute lesen (Über 152 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/23/%E9%BB%91%E9%87%91Alinx%20xc7z020%20%E5%8E%9F%E7%90%86%E5%9B%BE/">黑金Alinx xc7z020 原理图</a></p><div class="content"><h1 id="时钟引脚"><a href="#时钟引脚" class="headerlink" title="时钟引脚"></a>时钟引脚</h1><h2 id="CLK：U18"><a href="#CLK：U18" class="headerlink" title="CLK：U18"></a>CLK：U18</h2><h1 id="复位"><a href="#复位" class="headerlink" title="复位"></a>复位</h1><h2 id="RST：N15"><a href="#RST：N15" class="headerlink" title="RST：N15"></a>RST：N15</h2><h1 id="扩展接口"><a href="#扩展接口" class="headerlink" title="扩展接口"></a>扩展接口</h1><h2 id="J10"><a href="#J10" class="headerlink" title="J10"></a>J10</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715858667344.png" alt="1715858667344.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715858711730.png" alt="1715858711730.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715858778817.png" alt="1715858778817.png|400"></p>
<h2 id="J11"><a href="#J11" class="headerlink" title="J11"></a>J11</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715858828182.png" alt="1715858828182.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715858880857.png" alt="1715858880857.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715859009851.png" alt="1715859009851.png|400"></p>
<h1 id="PL-LED"><a href="#PL-LED" class="headerlink" title="PL LED"></a>PL LED</h1><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1715859045637.png" alt="1715859045637.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1736475075441.png" alt="1736475075441.png|400"></p>
<h1 id="PL-KEY"><a href="#PL-KEY" class="headerlink" title="PL KEY"></a>PL KEY</h1><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1736475179705.png" alt="1736475179705.png|400"></p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1736475192537.png" alt="1736475192537.png|400"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-06-12T16:00:00.000Z" title="2024/6/13 00:00:00">2024-06-13</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:42:51.295Z" title="2025/1/20 10:42:51">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">a minute lesen (Über 207 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/13/MATLAB%E4%B8%AD%E4%BD%BF%E7%94%A8HDL%20Coder%E7%94%9F%E6%88%90HDL%E4%BB%A3%E7%A0%81%E6%97%B6%E7%9A%84%E6%8A%A5%E9%94%99%E9%9B%86%E5%90%88/">MATLAB中使用HDL Coder生成HDL代码时的报错集合</a></p><div class="content"><h1 id="Delay-balancing-unsuccessful-because-an-extra-4-cycles-of-latency-introduced-by-optimizations-in-the-feedback-loop-cannot-be-offset-using-design-delays-for-the-loop-latency-budget"><a href="#Delay-balancing-unsuccessful-because-an-extra-4-cycles-of-latency-introduced-by-optimizations-in-the-feedback-loop-cannot-be-offset-using-design-delays-for-the-loop-latency-budget" class="headerlink" title="Delay balancing unsuccessful because an extra 4 cycles of latency introduced by optimizations in the feedback loop cannot be offset using design delays for the loop latency budget."></a>Delay balancing unsuccessful because an extra 4 cycles of latency introduced by optimizations in the feedback loop cannot be offset using design delays for the loop latency budget.</h1><h2 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h2><p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/2024after4202406132008890.png" alt="2024after4202406132008890.png"></p>
<p>由于时序考虑，在每个模块的输出端添加了1到2级的输入输出流水线，但是在这种带反馈的结构上添加输入输出流水线后，会产生如下的报错</p>
<p><img src="https://sawen-pic-blog.oss-cn-beijing.aliyuncs.com/utool_pic/1718280602962.png" alt="1718280602962.png"></p>
<p>可以看出加入的输入输出流水线会导致额外的时钟延时，使得延时平衡失败。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>在保证时序的前提下将带有反馈回路的模块输入输出流水线设置为0，也可以在同级输出端口加入delay手动添加流水线。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2024-06-08T16:00:00.000Z" title="2024/6/9 00:00:00">2024-06-09</time></span><span class="level-item">Aktualisiert vor&nbsp;<time dateTime="2025-01-20T02:41:52.767Z" title="2025/1/20 10:41:52">2025-01-20</time></span><span class="level-item"><a class="link-muted" href="/categories/FPGA/">FPGA</a></span><span class="level-item">2 minutes lesen (Über 249 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/09/Modelsim%E4%B8%AD%E4%BD%BF%E7%94%A8tcl%E5%91%BD%E4%BB%A4%E5%AF%BC%E5%87%BA%E4%BB%BF%E7%9C%9F%E6%95%B0%E6%8D%AE%E5%88%B0txt%E6%96%87%E4%BB%B6/">Modelsim中使用tcl命令导出仿真数据到txt文件</a></p><div class="content"><p>参考下面的CSDN博客</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lum250/article/details/121237146">bookmark</a></p>
<h1 id="Tcl命令"><a href="#Tcl命令" class="headerlink" title="Tcl命令"></a>Tcl命令</h1><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">proc write_sim_data &#123;env name radix cycle file&#125; &#123;</span><br><span class="line">    set fid [open $file w]</span><br><span class="line">    <span class="keyword">for</span> &#123;set i <span class="number">0</span>&#125; &#123;$i &lt;= $::now&#125; &#123;incr i [expr $cycle * <span class="number">1000</span>]&#125; &#123;</span><br><span class="line">        set str [exa -env $env -radix $radix -<span class="keyword">time</span> $&#123;i&#125;ps &#123;*&#125;$name]</span><br><span class="line">        puts $fid $str</span><br><span class="line">    &#125;</span><br><span class="line">    close $fid </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Line1：定义一个名为write_sim_data的过程，参数列表为：{env name radix cycle file}</p>
<p>  env：指定查找对象名称的路径。如top_tb&#x2F;top_u<br>  name：需要导出的变量列表。如{I_reset_n R_data_cnt}<br>  radix：进制。可选：ascii,binary, decimal,hexadecimal,unsigned等<br>  cycle：时钟周期，单位ns<br>  file：输出文件。如.&#x2F;1.txt</p>
</li>
<li><p>Line2：打开一个文档，返回文件描述符</p>
</li>
<li><p>Line3：分别获得从0到仿真结尾时间，按时钟周期间隔对数据进行取样输出</p>
</li>
<li><p>Line4：获得具体数据</p>
</li>
<li><p>Line5：将数据写入文件</p>
</li>
<li><p>Line7：关闭文件</p>
</li>
</ul>
<p>示例：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write_sim_data sim:/top_tb/u_top_wrapper/top_i/RS_Enc_0 &#123;RS_Out Trigger&#125; <span class="keyword">unsigned</span> <span class="number">1000</span> data<span class="variable">.txt</span></span><br></pre></td></tr></table></figure>

</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/tags/FPGA/page/0/">Zurück</a></div><div class="pagination-next"><a href="/tags/FPGA/page/2/">Weiter</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/tags/FPGA/">1</a></li><li><a class="pagination-link" href="/tags/FPGA/page/2/">2</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/banner.png" alt="Sawen_Blog"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Sawen_Blog</p><p class="is-size-6 is-block">一个路过的工科牲</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Beijing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Seiten</p><a href="/archives/"><p class="title">41</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories/"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">8</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/moerjie" target="_blank" rel="me noopener">Folgen</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/moerjie"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="CSDN" href="https://blog.csdn.net/qq_66439282?type=blog"><i class="fa-brands fa-cuttlefish"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Xlog" href="https://moerjielovecookie-4735.xlog.app/"><i class="fa-brands fa-mixer"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Kategorien</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/FPGA/"><span class="level-start"><span class="level-item">FPGA</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E5%AD%97%E9%80%9A%E4%BF%A1/"><span class="level-start"><span class="level-item">数字通信</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%9D%82%E7%B1%BB/"><span class="level-start"><span class="level-item">杂类</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%94%B5%E8%B7%AF/"><span class="level-start"><span class="level-item">电路</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Letzte Einträge</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-26T16:00:00.000Z">2025-01-27</time></p><p class="title"><a href="/2025/01/27/ZYNQ-PS%20GPIO%E4%B8%AD%E6%96%AD%E8%BF%87%E7%A8%8B/">ZYNQ-PS GPIO中断过程</a></p><p class="categories"><a href="/categories/FPGA/">FPGA</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-24T16:00:00.000Z">2025-01-25</time></p><p class="title"><a href="/2025/01/25/ZYNQ-AXI%20DMA+AXI-S%20FIFO%E5%9B%9E%E7%8E%AF%E5%AD%A6%E4%B9%A0/">AXI DMA+AXI-S FIFO回环学习</a></p><p class="categories"><a href="/categories/FPGA/">FPGA</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-23T16:00:00.000Z">2025-01-24</time></p><p class="title"><a href="/2025/01/24/hexo%E9%83%A8%E7%BD%B2%E5%88%B0github%20page%E6%97%B6%EF%BC%8Chexo%20d%E5%90%8Epage%E9%87%8C%E9%9D%A2%E7%BB%91%E5%AE%9A%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%9F%9F%E5%90%8D%E6%B6%88%E5%A4%B1%E7%9A%84%E9%97%AE%E9%A2%98/">hexo部署到github page时，hexo d后page里面绑定的个人域名消失的问题</a></p><p class="categories"><a href="/categories/%E6%9D%82%E7%B1%BB/">杂类</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-20T16:00:00.000Z">2025-01-21</time></p><p class="title"><a href="/2025/01/21/Verilog%E4%B8%ADif%E8%AF%AD%E5%8F%A5%E5%92%8Ccase%E8%AF%AD%E5%8F%A5%E7%BB%BC%E5%90%88%E5%87%BA%E7%9A%84%E7%94%B5%E8%B7%AF%E5%8C%BA%E5%88%AB/">Verilog中if语句和case语句综合出的电路区别</a></p><p class="categories"><a href="/categories/FPGA/">FPGA</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-19T16:00:00.000Z">2025-01-20</time></p><p class="title"><a href="/2025/01/20/ZYNQ-IP-AXI-GPIO/">ZYNQ-IP-AXI-GPIO</a></p><p class="categories"><a href="/categories/FPGA/">FPGA</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archive</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">January 2025</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">November 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">April 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/FPGA/"><span class="tag">FPGA</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MATLAB/"><span class="tag">MATLAB</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Report/"><span class="tag">Report</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZYNQ/"><span class="tag">ZYNQ</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bug/"><span class="tag">bug</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/coding/"><span class="tag">coding</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E5%AD%97%E9%80%9A%E4%BF%A1/"><span class="tag">数字通信</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%94%B5%E8%B7%AF/"><span class="tag">电路</span><span class="tag">5</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Abonnieren Sie Updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Abonnieren"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Abonnieren"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.png" alt="Sawen_Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Sawen Moerjie</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2023</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "Diese Website verwendet Cookies, um Ihre Erfahrung zu verbessern.",
          dismiss: "Verstanden!",
          allow: "Cookies zulassen",
          deny: "Ablehnen",
          link: "Mehr erfahren",
          policy: "Cookie-Richtlinie",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Ohne Titel)","posts":"Seiten","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>